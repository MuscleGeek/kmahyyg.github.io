<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Potato Online</title>
  
  <subtitle>Trust , But Verify!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.kmahyyg.xyz/"/>
  <updated>2019-04-13T16:01:32.350Z</updated>
  <id>https://www.kmahyyg.xyz/</id>
  
  <author>
    <name>Patrick Young</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>操作系统原理 - PV原语与互斥锁、信号量</title>
    <link href="https://www.kmahyyg.xyz/2019/OS-pvNmutex/"/>
    <id>https://www.kmahyyg.xyz/2019/OS-pvNmutex/</id>
    <published>2019-04-13T23:19:40.000Z</published>
    <updated>2019-04-13T16:01:32.350Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://blog.csdn.net/Tanswer_/article/details/71083602" target="_blank" rel="noopener">https://blog.csdn.net/Tanswer_/article/details/71083602</a><br><a href="https://www.cnblogs.com/cocowool/archive/2012/06/11/2544823.html" target="_blank" rel="noopener">https://www.cnblogs.com/cocowool/archive/2012/06/11/2544823.html</a><br><a href="https://www.jianshu.com/p/67c536ad4efe" target="_blank" rel="noopener">https://www.jianshu.com/p/67c536ad4efe</a><br><a href="http://timothyqiu.com/archives/spinlock-mutex-condition-variable-readers-writer-lock/" target="_blank" rel="noopener">http://timothyqiu.com/archives/spinlock-mutex-condition-variable-readers-writer-lock/</a><br><a href="https://www.zhihu.com/question/40562993/answer/87204567" target="_blank" rel="noopener">https://www.zhihu.com/question/40562993/answer/87204567</a></p><p>全文转载了原作者的文章，因为国内网络环境差，不知道什么时候就 404 了，还请原作者谅解。版权归原作者所有，如有疑问，请与我联系。</p><h1 id="PV-原语-文献-1"><a href="#PV-原语-文献-1" class="headerlink" title="PV 原语 - 文献 1"></a>PV 原语 - 文献 1</h1><h2 id="信号量S的物理含义"><a href="#信号量S的物理含义" class="headerlink" title="信号量S的物理含义"></a>信号量S的物理含义</h2><p>S&gt;0：表示有S个资源可用；S=0表示无资源可用；S&lt;0绝对值表示等待队列或链表中的进程个数。信号量的初值应大于等于0。</p><h2 id="PV原语小结"><a href="#PV原语小结" class="headerlink" title="PV原语小结"></a>PV原语小结</h2><p>通过操作信号量来处理进程间的同步与互斥的问题。其核心就是一段不可分割不可中断的程序。</p><p>信号量是由操作系统来维护的，用户进程只能通过初始化和两个标准原语（P、V原语）来访问，它们在执行时是不可中断的。初始化可指定一个非负整数，即空闲资源总数。</p><p>P原语：P是荷兰语Proberen（测试）的首字母。为阻塞原语，负责把当前进程由运行状态转换为阻塞状态，直到另外一个进程唤醒它。操作为：申请一个空闲资源（把信号量减1），则若成功，则退出；若失败，则该进程被阻塞；</p><p>V原语：V是荷兰语Verhogen（增加）的首字母。为唤醒原语，负责把一个被阻塞的进程唤醒，它有一个参数表，存放着等待被唤醒的进程信息。操作为：释放一个被占用的资源（把信号量加1），如果发现有被阻塞的进程，则选择一个唤醒之。</p><p>P(S)：表示申请一个资源，S减 1；若 减1 后仍S&gt;=0，则该进程继续执行；若 减1 后 S&lt;0，表示已无资源可用，需要将自己阻塞起来。</p><p>V(S)：表示释放一个资源，S加 1；若 加1 后S&gt;0，则该进程继续执行；若 加1 后 S&lt;=0，表示等待队列上有等待进程，需要将第一个等待的进程唤醒。</p><p>PV原语对信号量的操作可以分为三种情况：</p><ol><li>把信号量视为一个加锁标志位，实现对一个共享变量的互斥访问。</li></ol><p>实现过程：</p><pre><code>P(mutex); // mutex的初始值为1访问该共享数据V(mutex);非临界区</code></pre><p>互斥信号量是根据临界资源的类型设置的。有几种类型的临界资源就设置几个互斥信号量。它代表该类临界资源的数量，或表示是否可用，其初值一般为“1”。</p><ol start="2"><li>把信号量视为是某种类型的共享资源的剩余个数，实现对一类共享资源的访问。</li></ol><p>实现过程：</p><pre><code>P(resource); // resource的初始值为该资源的个数N使用该资源；V(resource);非临界区</code></pre><ol start="3"><li>把信号量作为进程间的同步工具</li></ol><p>实现过程：</p><pre><code>临界区C1； P(S);V(S);     临界区C2；</code></pre><p>同步信号量是根据进程的数量设置的。一般情况下，有几个进程就设置几个同步信号量，表示该进程是否可以执行，或表示该进程是否执行结束，其初值一般为“0”。</p><h2 id="同步与互斥的解题思路"><a href="#同步与互斥的解题思路" class="headerlink" title="同步与互斥的解题思路"></a>同步与互斥的解题思路</h2><p>分清哪些是互斥问题（互斥访问临界资源的），哪些是同步问题（具有前后执行顺序要求的）。</p><p>对互斥问题要设置互斥信号量，不管有互斥关系的进程有几个或几类，通常只设置一个互斥信号量，且初值为1，代表一次只允许一个进程对临界资源访问。</p><p>对同步问题要设置同步信号量，通常同步信号量的个数与参与同步的进程种类有关，即同步关系涉及几类进程，就有几个同步信号量。同步信号量表示该进程是否可以开始或该进程是否已经结束。</p><p>在每个进程中用于实现互斥的PV操作必须成对出现；用于实现同步的PV操作也必须成对出现，但可以分别出现在不同的进程中；在某个进程中如果同时存在互斥与同步的P操作，则其顺序不能颠倒，必须先执行对同步信号量的P操作，再执行对互斥信号量的P操作，但V操作的顺序没有严格要求。</p><h2 id="为什么P操作不能颠倒？"><a href="#为什么P操作不能颠倒？" class="headerlink" title="为什么P操作不能颠倒？"></a>为什么P操作不能颠倒？</h2><p>解进程同步和互斥问题的方法步骤</p><p>1) 关系分析。找出问题中的进程数，并且分析它们之间的同步和互斥关系。同步、互斥关系直接按照上面的经典范式改写。</p><p>2) 整理思路。找出解决问题的关键点，并且根据做过的题目找出解决的思路。根据进程的操作流程确定P操作、V操作的大致顺序。</p><p>3) 设置信号量。根据上面两步，设置需要的信号量，确定初值，完善整理。</p><h3 id="生产者消费者问题"><a href="#生产者消费者问题" class="headerlink" title="生产者消费者问题"></a>生产者消费者问题</h3><p>问题描述</p><p>一组生产者进程和一组消费者进程共享一个初始为空、大小为n的缓冲区，只有缓冲区没满时，生产者才能把消息放入到缓冲区，否则必须等待；只有缓冲区不空时，消费者才能从中取出消息，否则必须等待。由于缓冲区是临界资源，它只允许一个生产者放入消息，或者一个消费者从中取出消息。</p><p>问题分析</p><p>关系分析：生产者往缓冲区写消息，，消费者从缓冲区取消息必须分开进行，所以两者是互斥关系；同时只有生产者放入消息后，消费者才能从中取出消息，所以两者还是同步关系。</p><p>整理思路：两个进程，既是互斥关系，又是同步关系。此时需要注意互斥同步PV操作的位置。</p><p>信号量设置：互斥信号量mutex，初值为1，保证互斥的访问缓冲池；信号量full记录当前缓冲池中满缓冲区个数，初值为0，信号量empty记录当前缓冲池空缓冲区个数，初值为n。</p><p>类C语言代码</p><pre class="line-numbers language-c"><code class="language-c">semaphore mutex<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//临界区互斥信号量</span>semaphore empty<span class="token operator">=</span>n<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//空闲缓冲区</span>semaphore full<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//缓冲区初始化为空</span><span class="token function">producer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//生产者进程</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        produce an item in nextp<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//生产数据</span>        <span class="token function">P</span><span class="token punctuation">(</span>empty<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//获取空缓冲区单元</span>        <span class="token function">P</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//进入临界区.</span>        add nextp to buffer<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//将数据放入缓冲区</span>        <span class="token function">V</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//离开临界区,释放互斥信号量</span>        <span class="token function">V</span><span class="token punctuation">(</span>full<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//满缓冲区数加1</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">consumer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//消费者进程</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">P</span><span class="token punctuation">(</span>full<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//获取满缓冲区单元</span>        <span class="token function">P</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 进入临界区</span>        remove an item from buffer<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//从缓冲区中取出数据</span>        <span class="token function">V</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//离开临界区，释放互斥信号量</span>        <span class="token function">V</span> <span class="token punctuation">(</span>empty<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//空缓冲区数加1</span>        consume the item<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//消费数据</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生产者消费者问题扩展"><a href="#生产者消费者问题扩展" class="headerlink" title="生产者消费者问题扩展"></a>生产者消费者问题扩展</h2><p>问题描述</p><p>桌子上有一只盘子，每次只能向其中放入一个水果。爸爸专向盘子中放苹果，妈妈专向盘子中放橘子，儿子专等吃盘子中的橘子，女儿专等吃盘子中的苹果。只有盘子为空时，爸爸或妈妈就可向盘子中放一个水果；仅当盘子中有自己需要的水果时，儿子或女儿可以从盘子中取出。</p><p>问题分析</p><p>关系分析：爸妈往盘子里放水果，必须互斥进行，所以爸妈是互斥关系；爸爸和女儿、妈妈和儿子是同步关系，类似生产者和消费者；儿子和女儿没有什么关系，有相应需求的水果就拿走</p><p>整理思路：有四个进程：爸爸放苹果、女儿吃苹果、妈妈放橘子、儿子吃橘子，可抽象为两对生产者消费者对一个缓冲区（盘子）进行操作</p><p>信号量设置：盘子plate为互斥信号量，表示是否允许向盘子中放置水果，初值为1， 表示允许放入。同步信号量设置两个，分别为apple、orange，因为两类进程：爸爸和女儿取放苹果、妈妈和儿子取放橘子。apple表示盘中是否有苹果，初值为0，表示盘子为空，不可取，若apple为1可以取；orange类似。</p><p>类C语言代码</p><pre class="line-numbers language-c"><code class="language-c">semaphore plate<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> apple<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> orange<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token function">father</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">//父亲进程</span><span class="token punctuation">{</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">P</span><span class="token punctuation">(</span>plate<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//互斥向盘中放水果  </span>        向盘中放苹果<span class="token punctuation">;</span>        <span class="token function">V</span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//放好后，此时可以取苹果</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">mother</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">//母亲进程</span><span class="token punctuation">{</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">P</span><span class="token punctuation">(</span>plate<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//互斥向盘中放水果</span>        向盘中放橘子<span class="token punctuation">;</span>        <span class="token function">V</span><span class="token punctuation">(</span>orange<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//放好后，此时可以取橘子</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">sun</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">//儿子进程</span><span class="token punctuation">{</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">P</span><span class="token punctuation">(</span>orange<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//互斥从盘中取橘子</span>        从盘中取橘子<span class="token punctuation">;</span>        <span class="token function">V</span><span class="token punctuation">(</span>plate<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//取完后盘子可用</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">daughter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">//女儿进程</span><span class="token punctuation">{</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">P</span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//互斥从盘中取苹果</span>        从盘中取苹果<span class="token punctuation">;</span>        <span class="token function">V</span><span class="token punctuation">(</span>plate<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//取完后盘子可用</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PV原语第二种类型示例"><a href="#PV原语第二种类型示例" class="headerlink" title="PV原语第二种类型示例"></a>PV原语第二种类型示例</h2><p>问题描述</p><p>某超市门口为顾客准备了100辆手推车，每位顾客在进去买东西时取一辆推车，在买完东西结完帐以后再把推车还回去。试用P、V操作正确实现顾客进程的同步互斥关系。</p><p>问题分析</p><p>把手推车视为某种资源，每个顾客为一个要互斥访问该资源的进程。因此这个例子为PV原语的第二种应用类型。</p><p>类C代码</p><pre class="line-numbers language-c"><code class="language-c">semaphore num<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span><span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">P</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>     买东西<span class="token punctuation">;</span>    结帐<span class="token punctuation">;</span>    <span class="token function">V</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="哲学家就餐问题"><a href="#哲学家就餐问题" class="headerlink" title="哲学家就餐问题"></a>哲学家就餐问题</h2><p>问题描述</p><p>一张圆桌上坐着5名哲学家，每两个哲学家之间的桌上摆一根筷子，桌子的中间是一碗米饭，如图所示。哲学家们倾注毕生精力用于思考和进餐，哲学家在思考时，并不影响他人。只有当哲学家饥饿的时候，才试图拿起左、 右两根筷子（一根一根地拿起）。如果筷子已在他人手上，则需等待。饥饿的哲学家只有同时拿到了两根筷子才可以开始进餐，当进餐完毕后，放下筷子继续思考。</p><p>问题分析</p><p>关系分析：5名哲学家与左右邻居对其中间筷子的访问是互斥关系。</p><p>整理思路：这里有五个进程。本题的关键是如何让一个哲学家拿到左右两个筷子而不造成死锁或者饥饿现象。那么解决方法有两个，一个是让他们同时拿两个筷子；二是对每个哲学家的动作制定规则，避免饥饿或者死锁现象的发生。为了防止死锁的发生，可以对哲学家进程施加一些限制条件，比如至多允许四个哲学家同时进餐;仅当一个哲学家左右两边的筷子都可用时才允许他抓起筷子;对哲学家顺序编号，要求奇数号哲学家先抓左边的筷子，然后再转他右边的筷子，而偶数号哲学家刚好相反。正解制定规则如下：假设釆用第二种方法，当一个哲学家左右两边的筷子都可用时，才允许他抓起筷子。</p><p>信号量设置：定义互斥信号量数组Chopstick[5] = {l, 1, 1, 1, 1}用于对5个筷子的互斥访问。取筷子的信号量mutex，初值为1</p><p>类C语言代码</p><pre class="line-numbers language-c"><code class="language-c">semaphore chopstick<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//初始化信号量</span>semaphore mutex<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//设置取筷子的信号量</span><span class="token function">Pi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//i号哲学家的进程</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">P</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//在取筷子前获得互斥量</span>        <span class="token function">P</span> <span class="token punctuation">(</span>chopstick <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//取左边筷子</span>        <span class="token function">P</span> <span class="token punctuation">(</span>chopstick<span class="token punctuation">[</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//取右边筷子</span>        <span class="token function">V</span> <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//释放取筷子的信号量</span>        eat<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//进餐</span>        <span class="token function">V</span><span class="token punctuation">(</span>chopstick<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//放回左边筷子</span>        <span class="token function">V</span><span class="token punctuation">(</span>chopstick<span class="token punctuation">[</span> <span class="token punctuation">(</span>i<span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//放回右边筷子</span>        think<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 思考</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>会发生死锁的算法</p><pre class="line-numbers language-c"><code class="language-c">semaphore chopstick<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//初始化信号量</span><span class="token function">Pi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//i号哲学家的进程</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">P</span> <span class="token punctuation">(</span>chopstick <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//取左边筷子</span>        <span class="token function">P</span> <span class="token punctuation">(</span>chopstick<span class="token punctuation">[</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//取右边筷子</span>        eat<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//进餐</span>        <span class="token function">V</span><span class="token punctuation">(</span>chopstick<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//放回左边筷子</span>        <span class="token function">V</span><span class="token punctuation">(</span>chopstick<span class="token punctuation">[</span> <span class="token punctuation">(</span>i<span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//放回右边筷子</span>        think<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 思考</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/*当每个哲学家同时拿起同一侧的筷子时，会发生死锁*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="信号量与互斥锁-文献-5"><a href="#信号量与互斥锁-文献-5" class="headerlink" title="信号量与互斥锁 - 文献 5"></a>信号量与互斥锁 - 文献 5</h1><ol><li>信号量（Semaphore）</li></ol><p>信号量就是一个停车场。</p><p>当前值是停车场里还剩下多少个空车位。最大值是停车场里最多能容纳多少个车位。</p><p>当汽车进入停车场时，首先要在门口排队(sem_wait)，得到进入许可后才能进入。排队顺序原则上先到先得。每进一辆车，停车场就少了1个停车位，即信号量当前值-1。当前值为0时，停车场停满了，所有车不得进入统统在门口排队等。当一辆车离开后，释放其所占据的停车位(sem_post)，信号量当前值+1信号量值得到释放后，如果门口有正在排队的车，那么就放进来，每放进来一个就重复前面的步骤。</p><ol start="2"><li>互斥锁（Mutex）</li></ol><p>Mutex就是厕所的隔间，门开着的时候谁都可以进，但是一次只能进一个人。进去后，就从里面锁上门。厕所里有人的时候其他人就要排队等，直到里面的人出来。</p><h1 id="各类锁的详细描述-文献-4"><a href="#各类锁的详细描述-文献-4" class="headerlink" title="各类锁的详细描述 - 文献 4"></a>各类锁的详细描述 - 文献 4</h1><p>自旋锁（spinlock）很好理解。对自旋锁加锁的操作，你可以认为是类似这样的：</p><pre><code>while (抢锁(lock) == 没抢到) {}</code></pre><p>只要没有锁上，就不断重试。显然，如果别的线程长期持有该锁，那么你这个线程就一直在 <code>while while while</code> 地检查是否能够加锁，浪费 CPU 做无用功。</p><p>仔细想想，其实没有必要一直去尝试加锁，因为只要锁的持有状态没有改变，加锁操作就肯定是失败的。所以，抢锁失败后只要锁的持有状态一直没有改变，那就让出 CPU 给别的线程先执行好了。这就是互斥器（mutex）也就是题目里的互斥锁（不过个人觉得既然英语里本来就不带 lock，就不要称作锁了吧）。对互斥器加锁的操作你可以认为是类似这样的：</p><pre><code>while (抢锁(lock) == 没抢到) {    本线程先去睡了请在这把锁的状态发生改变时再唤醒(lock);}</code></pre><p>操作系统负责线程调度，为了实现「锁的状态发生改变时再唤醒」就需要把锁也交给操作系统管理。所以互斥器的加锁操作通常都需要涉及到上下文切换，操作花销也就会比自旋锁要大。</p><p>以上两者的作用是加锁互斥，保证能够排它地访问被锁保护的资源。</p><p>不过并不是所有场景下我们都希望能够独占某个资源，很快你可能就会不得不写出这样的代码：</p><pre><code>// 这是「生产者消费者问题」中的消费者的部分逻辑// 等待队列非空，再从队列中取走元素进行处理加锁(lock);  // lock 保护对 queue 的操作while (queue.isEmpty()) {  // 队列为空时等待    解锁(lock);    // 这里让出锁，让生产者有机会往 queue 里安放数据    加锁(lock);}data = queue.pop();  // 至此肯定非空，所以能对资源进行操作解锁(lock);消费(data);  // 在临界区外做其它处理</code></pre><p>你看那个 while，这不就是自己又搞了一个自旋锁么？区别在于这次你不是在 while 一个抽象资源是否可用，而是在 while 某个被锁保护的具体的条件是否达成。</p><p>有了前面自旋锁、互斥器的经验就不难想到：「只要条件没有发生改变，<code>while</code> 里就没有必要再去加锁、判断、条件不成立、解锁，完全可以让出 CPU 给别的线程」。不过由于「条件是否达成」属于业务逻辑，操作系统没法管理，需要让能够作出这一改变的代码来手动「通知」，比如上面的例子里就需要在生产者往 <code>queue</code> 里 <code>push_back</code> 后「通知」!<code>queue.isEmpty()</code> 成立。</p><p>也就是说，我们希望把上面例子中的 <code>while</code> 循环变成这样：</p><pre><code>while (queue.isEmpty()) {    解锁后等待通知唤醒再加锁(用来收发通知的东西, lock);}</code></pre><p>生产者只需在往 <code>queue</code> 中 <code>push_back</code> 数据后这样，就可以完成协作：</p><pre><code>触发通知(用来收发通知的东西);// 一般有两种方式：//   通知所有在等待的（notifyAll / broadcast）//   通知一个在等待的（notifyOne / signal）这就是条件变量（condition variable），也就是问题里的条件锁。它解决的问题不是「互斥」，而是「等待」。</code></pre><p>至于读写锁（readers-writer lock），看英文可以顾名思义，在执行加锁操作时需要额外表明读写意图，复数读者之间并不互斥，而写者则要求与任何人互斥。读写锁不需要特殊支持就可以直接用之前提到的几个东西实现，比如可以直接用两个 spinlock 或者两个 mutex 实现：</p><pre><code>void 以读者身份加锁(rwlock) {    加锁(rwlock.保护当前读者数量的锁);    rwlock.当前读者数量 += 1;    if (rwlock.当前读者数量 == 1) {        加锁(rwlock.保护写操作的锁);    }    解锁(rwlock.保护当前读者数量的锁);}void 以读者身份解锁(rwlock) {    加锁(rwlock.保护当前读者数量的锁);    rwlock.当前读者数量 -= 1;    if (rwlock.当前读者数量 == 0) {        解锁(rwlock.保护写操作的锁);    }    解锁(rwlock.保护当前读者数量的锁);}void 以写者身份加锁(rwlock) {    加锁(rwlock.保护写操作的锁);}void 以写者身份解锁(rwlock) {    加锁(rwlock.保护写操作的锁);}</code></pre><p>如果整个场景中只有一个读者、一个写者，那么其实可以等价于直接使用互斥器。不过由于读写锁内部是至少需要用一把锁来保护当前读者数的，所以，如果你的临界区很小，读写锁相比一般的锁并不能带来很大的优势，甚至可能性能更低。</p><p>另一方面，读写锁要真正发挥效能，条件也比较麻烦。比如实际的读写锁通常不用例子里两把锁的实现，而是用一把锁、一个条件变量来实现，好处是可以缓解写者饥饿的情况（一旦有写者在等锁，后续读者都需要等写者离开后才能继续），但这样一来，如果读者的临界区没有明显小于写者的临界区，阻塞情况可能会变得比较不理想……</p><p>所以你可以认为读写锁是针对某种特定情景的「优化」。不是说不要用读写锁，而是读写锁往往没有看上去那么理想。个人建议是可以优先用 mutex，如果遇到瓶颈后可以选择替换为读写锁，看看能否带来性能提升。</p><p>以上。</p><h1 id="进程的同步、互斥以及PV原语-文献-2"><a href="#进程的同步、互斥以及PV原语-文献-2" class="headerlink" title="进程的同步、互斥以及PV原语 - 文献 2"></a>进程的同步、互斥以及PV原语 - 文献 2</h1><p>在处理进程间的同步与互斥问题时，我们离不开信号量和PV原语，使用这两个工具的目的在于打造一段不可分割不可中断的程序。应当注意的是，信号量和PV原语是解决进程间同步与互斥问题的一种机制，但并不是唯一的机制。</p><h2 id="信号量："><a href="#信号量：" class="headerlink" title="信号量："></a>信号量：</h2><p>信号量的概念1965年由著名的荷兰计算机科学家 Edsger Wybe Dijkstra 艾兹格·迪科斯彻 提出。</p><p>其核心思想是用一种新的变量类型（Semaphore）来记录可用资源的数量。有两种实现方式：</p><p>1、Semaphore的取值必须大于或等于0。0表示当前已经没有空闲资源，而正数表示当前空闲资源的数量；</p><p>2、Semaphore的取值可正可负，负数的绝对值表示正在等待进入临界区的进程个数；</p><p>信号量是一个二元组（S，Q）。S是一个具有非负初值的整型变量，Q是一个初始状态为空的队列。</p><h2 id="PV原语"><a href="#PV原语" class="headerlink" title="PV原语"></a>PV原语</h2><p>P原语：P是荷兰语Proberen（测试）的首字母。为阻塞原语，负责把当前进程由运行状态转换为阻塞状态，直到另一个进程唤醒它。具体操作为：申请一个空闲资源（把信号量减1），若成功，则退出；若失败，则该进程被阻塞。</p><p>V原语：V是荷兰语Verhogen（增加）的首字母。为唤醒原语，负责把一个被阻塞的进程唤醒，他有一个参数表，存放着等待被唤醒的进程信息。具体操作为：释放一个被占用的资源（把信号量加1），如果发现有被阻塞的进程，则选择一个唤醒。</p><h2 id="表示方法"><a href="#表示方法" class="headerlink" title="表示方法"></a>表示方法</h2><p>P(S)：表示将信号量S的值减一，即S=S-1；如果S&gt;=0，则该进程继续执行，否则该进程置为等待状态，排入等待队列（队列Q）。</p><p>V(S)：表示将信号量S的值加一，即S=S+1；如果S&gt;0，则该进程继续执行，否则释放队列（Q）中第一个等待信号量的进程。</p><h3 id="实现互斥模型"><a href="#实现互斥模型" class="headerlink" title="实现互斥模型"></a>实现互斥模型</h3><p>在互斥模型中，多个进程对可用资源进行争用，使用信号量S表示可用资源的数量。一般来说，信号量S&gt;=0时，S表示可用资源的数量。执行一次P操作意味着请求分配一个单位资源，因此S的值减1；当S&lt;0时，表示已经没有可用资源，请求者必须等待别的进程释放该类资源，它才能运行下去。而执行一个V操作意味着释放一个单位资源，因此S的值加1；若S&lt;=0，表示有某些进程正在等待该资源，因此要唤醒一个等待状态的进程，使之运行下去。</p><p>进程互斥是进程之间发生的一种间接性作用，一般是程序不希望的。</p><p>如下表所示，我们使用S=1做为初值，表示当前系统资源只有一个，多个进程需要轮流使用这个资源。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/2019-pv-coolwolf1.webp" alt></p><p>在互斥模型的问题中，关键的问题在于使用PV操作来保证有限的系统资源被正常的使用和释放，而不是多人争抢谁都抢不到，或者某人独占而不释放的情况。有点类似于北京现在的摇号制度，实际上资源就是两万个号牌，每个申请的人都执行了一次P操作，表示自己想要使用资源，在摇号结果出来之前没有资源可用，大家都进入Q队列等候，放号之时，获得资格的用户执行V操作，释放一个等待位置，其他人可以进入下一次的排号等候队列。</p><h3 id="实现同步模型"><a href="#实现同步模型" class="headerlink" title="实现同步模型"></a>实现同步模型</h3><p>所谓同步，是指多个相互合作的进程，在一些关键点上可能需要相互等待或相互交换信息，这种互相制约的关系称为进程同步。例如系统中有两个合作的进程，他们共用一个单缓冲区。这两个进程一个是计算进程，负责对数据进行计算；另一个为打印进程，负责对计算结果进行打印。当计算进程没有计算完毕，计算结果没有送到缓冲区的时候，打印进程就不能打印。一旦计算进程把计算结果送入缓冲区，就应该给打印进程发送一个信号，打印进程收到信号后就可以从缓冲区中取出计算结果进行打印。</p><p>之前我在想这个同步模型的时候，考虑可以使用定时轮询的方式，计算进程定时查询缓冲区，可用即开始写入；打印进程定时查询缓冲区，有内容即开始打印。但是这种没有相互合作沟通的方式，非常容易出现问题，比如计算进程内容还没有写完，打印进程就开始读取打印，造成分页的不正确或者数据的不完整。实际上，一般我们都会有多个计算进程，这种情况下就会同时存在资源争用的问题。</p><p>进程同步是进程之间直接的相互作用，是合做进程间有意识的行为。与互斥模型不同，进程同步时的信号量只与制约进程、被制约进程有关而不是与所有的同类并发进程有关，所以同步模型中的信号量为私有信号量。</p><p>生产者-消费者模型是同步模型的典型代表，其也存在多种情况，分别叙述如下：</p><p>1、一个生产者，一个消费者，共用一个缓冲区。</p><p>定义两个同步信号量，生产者需要一个EMPTY信号量来判断当前是否能够写入，设置初值为1，消费者需要一个FULL信号量，来判断当前是否能够读取，设置初值为0。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/2019-pv-coolwolf2.webp" alt></p><p>2、一个生产者，一个消费者，共用N个缓冲区。</p><p>与上面的例子不同的是，EMPTY的初值为N，则生产者的阻塞时间会减少很多。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/2019-pv-coolwolf3.webp" alt></p><p>3、多个生产者，多个消费者，共用N个缓冲区。</p><p>在这种场景下，除了同步之外，还需要在生产者之间、消费者之间进行互斥的访问缓冲区，所以需要设置四个信号量，分别是EMPTY、FULL、生产者之间的互斥信号量Mutex1、消费者之间的互斥信号量Mutex2。</p><p>非生产者、消费者模型的例子有一个司机和售票员的。设置RUN信号量供司机判断是否应该开车，初始值为0；设置STOP信号量供售票员判断是否可以开门，初始值为0。描述如下：</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/2019-pv-coolwolf4.webp" alt></p><p>前驱图（Precedence Graph）是一种有向无循环图，记为DAG（Directed Acyclic Graph），用于描述进程间执行的前后关系。如下图：</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/2019-pv-coolwolf5.webp" alt></p><p>图中的每个结点可用于描述一个进程段或进程，乃至一条语句；结点间的有向边则用于表示两个结点之间存在的偏序（Partial Order）或前驱关系。可以使用PV原语，来描述前驱图。</p><p>PS：互斥的问题可以用硬件方法解决，如何解决，不太清楚。</p><h1 id="常见习题-文献-2"><a href="#常见习题-文献-2" class="headerlink" title="常见习题 - 文献 2"></a>常见习题 - 文献 2</h1><p>太大，文件太多，懒得搬运了，直接截长图了。</p><p>麻烦自己下载之后查看吧。  <a href="https://alicdn.kmahyyg.xyz/asset_files/2019-pv-jianshuqa.zip" target="_blank" rel="noopener">Click here to download</a></p><p>(END)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>Java 语言笔记 - OOP - 对象构造</title>
    <link href="https://www.kmahyyg.xyz/2019/Java-OOP-ObjConst/"/>
    <id>https://www.kmahyyg.xyz/2019/Java-OOP-ObjConst/</id>
    <published>2019-04-10T00:28:49.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="Java-语言笔记-OOP-对象构造"><a href="#Java-语言笔记-OOP-对象构造" class="headerlink" title="Java 语言笔记 - OOP - 对象构造"></a>Java 语言笔记 - OOP - 对象构造</h1><p>Last Edited: Apr 10, 2019 12:26 AM</p>        <div id="aplayer-zTBCjXxs" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">            <pre class="aplayer-lrc-content"></pre>        </div>        <script>          var ap = new APlayer({            element: document.getElementById("aplayer-zTBCjXxs"),            narrow: false,            autoplay: false,            showlrc: false,            music: {              title: "Lady of the Pier",              author: "Devotion OST",              url: "https://alicdn.kmahyyg.xyz/asset_files/LotP-Merged.mp3",              pic: "",              lrc: ""            }          });          window.aplayers || (window.aplayers = []);          window.aplayers.push(ap);        </script><h2 id="对象构造"><a href="#对象构造" class="headerlink" title="对象构造"></a>对象构造</h2><p>(1) <code>overloading</code> 重载</p><p>多个构造器方法有相同的名字、不同的参数，便产生了重载。编译器必须挑选出具体执行哪个方法。如果找不到匹配的参数，或者找到多个，就会产生编译时错误。 Java 允许重载任何方法，因此描述一个方法，必须完整指明参数名和参数类型。</p><p>(2) 默认域</p><p>若构造器中没有显式赋予初值，则默认数值型 <code>0</code> 、布尔值 <code>False</code> 、对象引用 <code>null</code> ，不建议默认不赋值。默认构造器，则是指默认没有参数的构造器。显式的域初始化在 Java 中是允许的，也是可行的。</p><p>(3) 参数名</p><p>为了避免隐式参数屏蔽实例域，可以采用 this 这个关键字进行访问。代码如下：</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token function">Employee</span><span class="token punctuation">(</span>String aName<span class="token punctuation">,</span> <span class="token keyword">double</span> aSalary<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> aName<span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> aSalary<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">private</span> String name<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">double</span> salary<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="关于-Overloading-的实践"><a href="#关于-Overloading-的实践" class="headerlink" title="关于 Overloading 的实践"></a>关于 Overloading 的实践</h3><p>使用 <code>this()</code> 调用同类中的不同构造器，其他构造器根据传入的参数返回实例化的对象：</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>*<span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token function">Employee</span><span class="token punctuation">(</span><span class="token keyword">double</span> s<span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">// 构造器的使用与重载</span>            <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token function">Employee</span><span class="token punctuation">(</span>String n<span class="token punctuation">,</span> <span class="token keyword">double</span> s<span class="token punctuation">)</span><span class="token punctuation">{</span>            name <span class="token operator">=</span> n<span class="token punctuation">;</span>            salary <span class="token operator">=</span> s<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> name<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">private</span> String name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">double</span> salary<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> cmpid<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>        <span class="token keyword">static</span> <span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">// 静态初始化块</span>            Random generator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cmpid <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 实例域初始化块</span>            id <span class="token operator">=</span> cmpid <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">;</span>            cmpid<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于构造器的调用，其具体的处理步骤如下：</p><ol><li>所有数据域初始化为默认值</li><li>根据在类声明中出现的次序，依次执行所有域初始化语句和初始化块</li><li>递归调用嵌套的构造器</li><li>执行当前构造器</li></ol><h4 id="析构器"><a href="#析构器" class="headerlink" title="析构器"></a>析构器</h4><p>析构器(deconstructor)， JVM 自己有 GC，所以 Java  不支持析构器。即使需要使用这一特性，Java 提供了 finalize() 方法，但是这个方法是不可靠、不安全的，无法确保被调用。如果使用了一些需要人工管理资源的类，请务必保证在使用完毕后调用类似 <code>dispose / close</code> 方法来完成相应清理操作。</p><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="https://stackoverflow.com/questions/2506488/when-is-the-finalize-method-called-in-java" target="_blank" rel="noopener">When is the finalize() method called in Java?</a></p><p><a href="https://www.cnblogs.com/100thMountain/p/5374423.html" target="_blank" rel="noopener">Java 中的 static 使用之静态初始化块 - Mountain’s_blog - 博客园</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>Java 语言笔记 - OOP - 使用现有的类与方法</title>
    <link href="https://www.kmahyyg.xyz/2019/Java-OOP-existedCls/"/>
    <id>https://www.kmahyyg.xyz/2019/Java-OOP-existedCls/</id>
    <published>2019-04-09T20:28:14.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="Java-语言笔记-OOP-使用现有的类与方法"><a href="#Java-语言笔记-OOP-使用现有的类与方法" class="headerlink" title="Java 语言笔记 - OOP - 使用现有的类与方法"></a>Java 语言笔记 - OOP - 使用现有的类与方法</h1><p>Last Edited: Apr 09, 2019 5:50 PM</p><ol><li>现有的类</li></ol><p>构造器名与类名应当相同，下列关系有两个差别：</p><pre class="line-numbers language-java"><code class="language-java">    Date birthday<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// birthday doesn't refer to any object</span>    Date birthday <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// this is a new built variable</span>    GregorianCalendar deadline <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GregorianCalendar</span><span class="token punctuation">(</span><span class="token number">1999</span><span class="token punctuation">,</span> Calendar<span class="token punctuation">.</span>DECEMBER<span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>最后一个实例使用的对应类封装了实例域，这个域保存了设置的信息，这样的一个类对外暴露了两个方法， <code>deadline.add(Calendar.MONTH, 3);</code> 和 <code>int weekday = birthday.get(Calendar.DAY_OF_WEEK);</code> 这两个方法，前者对实例与做出修改，称为更改器(mutator method)方法。后者仅访问实例域而不进行修改，称为访问器方法(accessor method)。对于实例化的类，我们需要关注的是类暴露出的方法而不是其内部实现。</p><p>Java 中非常注重本地化输出，对于这类需要 i18n 输出的，应当在第一行添加 <code>Locale.setDefault(Locale.ITALY)</code> 表明默认区域。</p><ol start="2"><li>用户自定义类</li></ol><p>在一个包中，应当只有一个类有 Main 方法。JVM 在试图运行一个类之前，先检查该类是否包含一个特殊方法。这个方法必须是公有的，以便在任何位置都能访问得到。这个方法必须是 static 的，因为这个方法不能依赖任何该类的实例即可运行，而非 static 的方法，在运行之前要先创建该类的实例对象。</p><p>这样的自定义类，可能需要抽象类来进行辅助。抽象类一定是父类，不可创建实例，只有覆盖了抽象类的所有抽象方法之后的子类才可以实例化。抽象类的关键字是 abstract.</p><p>abstract 不能和哪些关键字一起用？</p><p>答：</p><ul><li>final ：最终不能更改，抽象肯定得定义抽象方法</li><li>private ：明显….你都私有了不让别人用还抽象干嘛</li><li>static : 静态直接能被类名调用，对抽象类来说是没有意义的</li></ul><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span><span class="token punctuation">{</span>        <span class="token keyword">private</span> String name<span class="token punctuation">;</span>        <span class="token keyword">private</span> String id<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">double</span> pay<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 构造函数，员工的3个属性</span>        <span class="token keyword">public</span> <span class="token function">worker</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span>String id<span class="token punctuation">,</span><span class="token keyword">double</span> pay<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>pay <span class="token operator">=</span> pay<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 抽象行为：工作</span>        <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">Programmer</span> <span class="token keyword">extends</span> <span class="token class-name">Worker</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 构造函数</span>        <span class="token keyword">public</span> <span class="token function">programmer</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span>String id<span class="token punctuation">,</span><span class="token keyword">double</span> pay<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 引用父类</span>            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>id<span class="token punctuation">,</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 工作行为：代码</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"I'm coding"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token keyword">extends</span> <span class="token class-name">Worker</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 特有属性：奖金</span>        <span class="token keyword">private</span> <span class="token keyword">double</span> bonus<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 构造函数，经理属性</span>        <span class="token keyword">public</span> <span class="token function">Manager</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span>String id<span class="token punctuation">,</span><span class="token keyword">double</span> pay<span class="token punctuation">,</span><span class="token keyword">double</span> bonus<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>id<span class="token punctuation">,</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>bonus <span class="token operator">=</span> bonus<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 工作行为：管理</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"I'm managing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>关于修饰符</li></ol><p>感谢亲亲可爱的小仙女的提问让我了解了这么多。</p><p><strong><em>类修饰符：</em></strong></p><p>public（访问控制符），将一个类声明为公共类，他可以被任何对象访问，一个程序的主类必须是公共类。</p><p>abstract，将一个类声明为抽象类，没有实现的方法，需要子类提供方法实现。</p><p>final，将一个类声明为最终（即非继承类），表示他不能被其他类继承。</p><p>friendly，默认的修饰符，只有在相同包中的对象才能使用这样的类。</p><p><strong><em>成员变量修饰符：</em></strong></p><p>public（公共访问控制符），指定该变量为公共的，他可以被任何对象的方法访问。</p><p>private（私有访问控制符）指定该变量只允许自己的类的方法访问，其他任何类（包括子类）中的方法均不能访问。</p><p>protected（保护访问控制符）指定该变量可以别被自己的类和子类访问。在子类中可以覆盖此变量。</p><p>friendly ，在同一个包中的类可以访问，其他包中的类不能访问。</p><p>final，最终修饰符，指定此变量的值不能变。</p><p>static（静态修饰符）指定变量被所有对象共享，即所有实例都可以使用该变量。变量属于这个类。</p><p>transient（过度修饰符）指定该变量是系统保留，暂无特别作用的临时性变量。</p><p>volatile（易失修饰符）指定该变量可以同时被几个线程控制和修改。</p><p><strong><em>方法修饰符</em></strong>：</p><p>public（公共控制符）</p><p>private（私有控制符）指定此方法只能有自己类等方法访问，其他的类不能访问（包括子类）</p><p>protected（保护访问控制符）指定该方法可以被它的类和子类进行访问。</p><p>final，指定该方法不能被重载。</p><p>static，指定不需要实例化就可以激活的一个方法。</p><p>synchronize，同步修饰符，在多个线程中，该修饰符用于在运行前，对他所属的方法加锁，以防止其他线程的访问，运行结束后解锁。</p><p>native，本地修饰符。指定此方法的方法体是用其他语言在程序外部编写的。</p><p>代码示例1：</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>*<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmployeeTest</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>            Employee staff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token number">71000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            staff<span class="token punctuation">.</span><span class="token function">raiseSalary</span><span class="token punctuation">(</span><span class="token number">80000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            staff<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token function">Employee</span><span class="token punctuation">(</span>String n<span class="token punctuation">,</span> <span class="token keyword">int</span> s<span class="token punctuation">)</span><span class="token punctuation">{</span>            name <span class="token operator">=</span> n<span class="token punctuation">;</span>            salary <span class="token operator">=</span> s<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"My name: "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> name<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">raiseSalary</span><span class="token punctuation">(</span><span class="token keyword">int</span> newsala<span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"My salary: %d \n"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> newsala<span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"My new salary: %d \n"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> salary<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">private</span> String name<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">int</span> salary<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>你会发现我在 EmployeeTest 里写了两个类，事实是：Java Compiler 会在启动时查找是否存在 Employee.class ，如果不存在就自动编译。末尾的 private 语句确保只有 Employee 类自身可以访问这些示例域，其他类的方法无法读写。</p><p>让我们继续来分析这段代码：这段代码包括了一个构造器和一个 getter，一个 setter，构造器在 new 对象时被调用，构造器与类同名、每个类可以有一个以上构造器和多个参数，构造器没有返回值。构造器中不能定义与实例域重名的局部变量，这样的局部变量会屏蔽了同名的实例域。</p><ol start="4"><li>显式参数与隐式参数</li></ol><p>上面的代码中的 newSalary() 方法有两个参数, 第一个参数是隐式参数（即 Employee 类），第二个参数是显式参数，即括号中的参数。</p><ol start="5"><li>封装的优点</li></ol><p>确保实例域不被第三方类进行未授权修改，修改内部方法不影响外部实现的同时，也可以通过修改修改器方法实现对数据的检查。</p><p>需要注意的一点是：不要编写返回引用可变对象的访问器方法，因为这样会同时更改一个可变对象，导致原有实例的私有域被更改。如果需要返回一个可变数据域的拷贝，可以使用克隆。</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> Date <span class="token function">getHireday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token punctuation">(</span>Date<span class="token punctuation">)</span> hireDay<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li>静态</li></ol><p>声明静态常量: <code>public static final int PI=8.99;</code></p><p>使用静态方法: 这种方法仅适用于所需参数全部显式提供，并且只需要访问类的静态域的情况，例如 </p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getNextID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> NextID<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// NOT: this.NextID;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="7"><li>一些特定的方法</li></ol><p><code>NumberFormat</code> 类中使用 <code>factory</code> 方法产生不同风格的格式化对象。</p><p><code>Main</code> 方法是静态方法，不对任何对象进行操作。<code>Main</code> 方法的目的是执行并创建程序运行所需要的对象。</p><ol start="8"><li>方法参数</li></ol><p>需要明确的一点是：Java 中和 C 中只存在 Call by Value&amp;Reference, 不存在 Call by name 的情况。一个方法可以修改传递引用所对应的变量值，但是不能修改传递值。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>Java 语言笔记 - OOP - 相关概念综述</title>
    <link href="https://www.kmahyyg.xyz/2019/Java-OOP-concept/"/>
    <id>https://www.kmahyyg.xyz/2019/Java-OOP-concept/</id>
    <published>2019-04-08T22:12:45.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="Java-语言笔记-OOP-相关概念综述"><a href="#Java-语言笔记-OOP-相关概念综述" class="headerlink" title="Java 语言笔记 - OOP - 相关概念综述"></a>Java 语言笔记 - OOP - 相关概念综述</h1><p>Last Edited: Apr 08, 2019 10:11 PM</p><p>类(class)是构造(construct)实例(instance)的蓝图，类将对象(object)的数据和行为组合通过封装(encapsulation)组合在一个包中，一个对象中的数据称为实例域(instance fields)，操作数据的过程称为方法(method)，上述值的组合就是这个对象的当前状态。通过扩展一个类来建立另外一个类的过程，称为继承(inheritance)。</p><p>对象具有三个主要特性：</p><ul><li>行为 behavior: 可以施加的操作 or 方法</li><li>状态 state: 施加对应方法时对象如何相应</li><li>表示 identity: 辨别具有相同行为与状态的不同对象</li></ul><p>作为一个类的实例而存在的对象，每个对象的标识永远不同，状态也常常存在差异。</p><p>类之间的关系常见的包括：</p><ul><li>依赖(dependence)：一个类的方法操作另一个类的对象</li><li>继承(aggregation)：类 A 的对象包含类 B 的对象</li><li>聚合(inheritance)：扩展原有类的对象和方法</li></ul><p>定义必须被严格遵循。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>Java 语言笔记 - 大数与数组</title>
    <link href="https://www.kmahyyg.xyz/2019/Java-BigintArray/"/>
    <id>https://www.kmahyyg.xyz/2019/Java-BigintArray/</id>
    <published>2019-04-08T18:30:57.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="Java-语言笔记-大数与数组"><a href="#Java-语言笔记-大数与数组" class="headerlink" title="Java 语言笔记 - 大数与数组"></a>Java 语言笔记 - 大数与数组</h1><p>Last Edited: Apr 08, 2019 6:30 PM</p><p>一、大数运算</p><p>类似于 Python，Java 的 java.math 包提供了实现了任意精度的整数和浮点数运算。使用静态的 ValueOf 方法可以将常规的数值转化为大数。</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>*<span class="token punctuation">;</span>    <span class="token keyword">import</span> java<span class="token punctuation">.</span>math<span class="token punctuation">.</span>*<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BigIntegerTest</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>            Scanner in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"How many numbers do you need to draw?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> k  <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"What's the highest one?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> n <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            BigInteger lotteryOdds <span class="token operator">=</span> BigInteger<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> k<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                lotteryOdds <span class="token operator">=</span> lotteryOdds<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>BigInteger<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>n <span class="token operator">-</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span>BigInteger<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Your odds are 1 in "</span> <span class="token operator">+</span> lotteryOdds <span class="token operator">+</span> <span class="token string">". Good luck!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>大数运算中没有常见的运算符，需要使用对应类的对应方法完成运算。详情请参考 Java API Reference</p><p>二、数组</p><p>数组的声明方式为： 数据类型 - 数组名。同样可以使用 C-like 的方式声明，但是，更多的时候我们推荐采用 Java-like 的方式声明。</p><p>对于数组的长度获取，我们可以通过 array.length 方法获取长度。</p><p>（1）for-each 循环</p><p>类似于 Python，这样的循环可以用下列形式表示：  for (int element : array){do sth;}</p><p>for-each 循环会尝试遍历数组中每一个元素，而不用接触他们的下标值。</p><p>如果你需要打印数组中的所有值（像 Python List 一样），你可以使用 <code>Arrays.toString()</code> 方法。需要注意的是，这个 <code>toString</code> 方法仅适用于一维数组，如果你需要对二维数组使用，你需要使用 <code>Arrays.deepToString()</code> 方法。二维数组的声明是 <code>int[][] magicSquare;</code> </p><p>Java 还可以通过类似的代码初始化一个匿名数组：</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> smallPrimes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">191</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 新建一个匿名数组</span>    smallPrimes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">56</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Java 中允许数组中的长度允许为 0, 但不能为 null</span>    <span class="token keyword">new</span> <span class="token class-name">elementType</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 数组的浅拷贝与深拷贝</span>    <span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Arrays<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayCopyTest</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> anonymous <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">}</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> anon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> smallprime <span class="token operator">=</span> anon<span class="token punctuation">;</span>            smallprime<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">66</span><span class="token punctuation">;</span>            <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> copiedNumbers <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>anon<span class="token punctuation">,</span> anon<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// Deepcopy</span>            copiedNumbers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">58</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>copiedNumbers<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>smallprime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>anon<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 数组元素到元素拷贝还可以使用 </span>    <span class="token comment" spellcheck="true">// java.lang.System.arraycopy(object from, int fromindex, object to, int toindex, int count);</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>(2) 命令行参数</p><p>Java 的 main 方法中，程序名不存储在 args 中，如果你使用下列方法运行一个应用， <code>java Massage -g critical</code> , args[0] 的值为 <code>-g</code></p><p>(3) 数组的排序问题</p><p>Java 中如果你需要对数值型数组数组进行排序，官方在 Arrays 类中提供了优化的快速排序算法，  <code>Arrays.sort()</code></p><p>(4) 不规则数组</p><p>Java 中实际并不存在多维数组，二维数组实际被同 Python 类似的理解为数组中的数组。</p><p>Java 中的声明 <code>double[][] balances = new double[10][6];</code> 实际等价于C的是 <code>double** balances = new doubles*[10]; for(i=0;i &lt; 10;i++){balances[i] = new double[6];}</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>操作系统原理 - 用户空间、内核空间与上下文</title>
    <link href="https://www.kmahyyg.xyz/2019/os-process-context/"/>
    <id>https://www.kmahyyg.xyz/2019/os-process-context/</id>
    <published>2019-04-08T00:51:52.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="警告"><a href="#警告" class="headerlink" title="警告"></a>警告</h1><p>本文很长，均为 Linux 实现，并将附赠源代码链接。请做好长时间阅读的准备。</p><p>作者的精力有限，本文将仅讨论 Linux Kernel 5.0.6 的 x86_32 和 x86_64 架构的相关实现。ARM 和 MIPS 架构在部分内容上有较大的区别，请有兴趣的读者自行 Google.</p><h1 id="内核空间与用户空间"><a href="#内核空间与用户空间" class="headerlink" title="内核空间与用户空间"></a>内核空间与用户空间</h1><p>下图是 Linux 的一个整体结构示意：</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/context_01_insidelinux.webp" alt="Kernel Memory Space"></p><h2 id="定义与铺垫"><a href="#定义与铺垫" class="headerlink" title="定义与铺垫"></a>定义与铺垫</h2><h3 id="虚拟内存地址"><a href="#虚拟内存地址" class="headerlink" title="虚拟内存地址"></a>虚拟内存地址</h3><p>我们首先需要明确的一点：现代操作系统为了性能考虑，全部采用了虚拟内存地址机制，来确保系统的高效运行。</p><p>那我们为什么需要采用虚拟内存地址：</p><ul><li>编译器编译产生的二进制运行产生的内存映像（Process Image）是将二进制文件中所有内容加载到内存的一个镜像，每一个函数都有一个 hardcoded 的保存地址，如果没有虚拟内存，想象一下多个程序同时运行的情况，必然产生代码冲突。</li><li>还是和上面一样，假设加载到内存地址产生冲突，但是恰好两部分代码一致，其中某一个程序出错了，这段内存被改写。另一个进程会因为这段被改写的内存空间而导致 crash.</li><li>同样的多进程环境，部分内存为了系统安全，应当不允许被系统内核之外的程序读取。如果不使用虚拟内存机制，难以对这一点做出保证。</li><li>假设采取内存分页机制，如果直接使用 direct address，不停的进行页交换，必然会导致严重的性能损耗。</li><li>根据硬件的不同，部分地址为某些硬件运行而预留，第三方改写或非法读取可能造成严重后果。</li><li>早期电脑的运行内存较小，虚拟内存机制可以将主存的部分空间用于临时充当内存。</li></ul><p>具体的对于内存地址的映射和管理问题，我们将在后续学习到内存调度时进一步阐述。</p><h3 id="内核空间与用户空间-1"><a href="#内核空间与用户空间-1" class="headerlink" title="内核空间与用户空间"></a>内核空间与用户空间</h3><h4 id="32-位架构的机器"><a href="#32-位架构的机器" class="headerlink" title="32 位架构的机器"></a>32 位架构的机器</h4><p>综上所述，我们在当前运行的电脑上（例如运行 gdb 调试程序时）看到的内存地址均为系统对物理内存进行映射后的虚拟地址。对于这部分地址的处理，Linux Kernel 在 32 位架构（最大内存寻址能力 4 GiB）的机器上将其分割为两部分，Low + High，比例为 Low: High = 3:1 ，具体的源代码可以参加 Linux 内核源码 <a href="https://elixir.bootlin.com/linux/v5.0.6/source/arch/x86/Kconfig#L1361" target="_blank" rel="noopener">arch/x86/Kconfig Line 1361</a>。对于 32 位架构，内存大于 4 GiB 的 Intel 机器，则内核会启用 Intel Physical Address Extension (PAE) 来扩展寻址到最大 64 GiB，这部分内容略去不表。</p><pre><code>Linux uses only 4 segments:2 segments (code and data/stack) for KERNEL SPACE from [0xC000 0000] (3 GB) to [0xFFFF FFFF] (4 GB)2 segments (code and data/stack) for USER SPACE from [0] (0 GB) to [0xBFFF FFFF] (3 GB)                               __   4 GB---&gt;|                |    |           |     Kernel     |    |  Kernel Space (Code + Data/Stack)           |                |  __|   3 GB---&gt;|----------------|  __           |                |    |           |                |    |   2 GB---&gt;|                |    |           |     Tasks      |    |  User Space (Code + Data/Stack)           |                |    |   1 GB---&gt;|                |    |           |                |    |           |________________|  __|  0x00000000          Kernel/User Linear addresses            ________________ _____                               |Other KernelData|___  |  |                |           |----------------|   | |__|                |           |     Kernel     |\  |____|   Real Other   |  3 GB ---&gt;|----------------| \      |   Kernel Data  |           |                |\ \     |                |           |              __|_\_\____|__   Real       |           |      Tasks     |  \ \   |     Tasks      |           |              __|___\_\__|__   Space      |           |                |    \ \ |                |           |                |     \ \|----------------|           |                |      \ |Real KernelSpace|           |________________|       \|________________|           Logical Addresses          Physical Addresses</code></pre><p>而这两部分空间的左右是什么呢？怎样才能正确的操作这部分空间呢？（保留原汁原味，不翻译！）</p><blockquote><p>Kernel space is where the kernel (i.e., the core of the operating system) executes (i.e., runs) and provides its services.</p></blockquote><blockquote><p>User space is that set of memory locations in which user processes (i.e., everything other than the kernel) run. A process is an executing instance of a program. One of the roles of the kernel is to manage individual user processes within this space and to prevent them from interfering with each other.</p></blockquote><blockquote><p>Kernel space can be accessed by user processes only through the use of system calls. System calls are requests in a Unix-like operating system by an active process for a service performed by the kernel, such as input/output (I/O) or process creation. An active process is a process that is currently progressing in the CPU, as contrasted with a process that is waiting for its next turn in the CPU. I/O is any program, operation or device that transfers data to or from a CPU and to or from a peripheral device (such as disk drives, keyboards, mice and printers).</p></blockquote><h4 id="64-位架构的机器"><a href="#64-位架构的机器" class="headerlink" title="64 位架构的机器"></a>64 位架构的机器</h4><p>对于 64 位架构的机器，其最大内存寻址能力为 17179869184 GiB，足以覆盖目前常见的绝大多数机器装配的内存。故而 Linux kernel 不再区分 Low/High Memory，全部视为 Low Memory。User Space 和 Kernel Space 的 Limit 均相同。现今的内存分页机制其实非常复杂，由于分页层数的不同，导致虚拟地址空间的大小也不同，具体相关描述请查看内核源代码和内核文档。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/context_02_lvmm_64.svg" alt="Linux Mapper of RAM_x64"></p><p>下列的文档可能对你了解这部分内容有所帮助。</p><ul><li><p><a href="https://en.wikibooks.org/wiki/The_Linux_Kernel/Memory" target="_blank" rel="noopener">https://en.wikibooks.org/wiki/The_Linux_Kernel/Memory</a></p></li><li><p><a href="https://elixir.bootlin.com/linux/v5.0.6/source/arch/x86/Kconfig#L1356" target="_blank" rel="noopener">https://elixir.bootlin.com/linux/v5.0.6/source/arch/x86/Kconfig#L1356</a></p></li><li><p><a href="https://elixir.bootlin.com/linux/v5.0.6/source/Documentation/vm/highmem.rst" target="_blank" rel="noopener">https://elixir.bootlin.com/linux/v5.0.6/source/Documentation/vm/highmem.rst</a></p></li></ul><blockquote><p>High memory (highmem) is used when the size of physical memory approaches or exceeds the maximum size of virtual memory. At that point it becomes impossible for the kernel to keep all of the available physical memory mapped at all times. This means the kernel needs to start using temporary mappings of the pieces of physical memory that it wants to access.</p></blockquote><ul><li><a href="https://elixir.bootlin.com/linux/v5.0.6/source/Documentation/x86/x86_64/mm.txt" target="_blank" rel="noopener">https://elixir.bootlin.com/linux/v5.0.6/source/Documentation/x86/x86_64/mm.txt</a></li></ul><blockquote><p>Architecture defines a 64-bit virtual address. Implementations can support<br>less. Currently supported are 48- and 57-bit virtual addresses. Bits 63<br>through to the most-significant implemented bit are sign extended.<br>This causes hole between user space and kernel addresses if you interpret them<br>as unsigned.</p></blockquote><blockquote><p>The direct mapping covers all memory in the system up to the highest<br>memory address (this means in some cases it can also include PCI memory<br>holes).</p></blockquote><h3 id="关于内核空间与内存安全"><a href="#关于内核空间与内存安全" class="headerlink" title="关于内核空间与内存安全"></a>关于内核空间与内存安全</h3><p>那为什么要区分内核空间和用户空间呢？每个进程到底能用到多少的内存呢？</p><p>操作系统的核心是系统内核，内核独立于普通的应用程序，可以访问受保护的内存空间、拥有访问底层所有硬件设备的最高权限，保护这部分内存就显得尤为重要。针对 32 位 Linux 操作系统而言，将最高的 1 GiB（从虚拟地址 0xC0000000 到 0xFFFFFFFF ），供内核使用，称为内核空间，而将较低的 3 GiB（从虚拟地址 0x00000000 到 0xBFFFFFFF ），供各个进程使用，称为用户空间。每个进程可以通过系统调用进入内核，因此，Linux 内核由系统内的所有进程共享。于是，从具体进程的角度来看，每个进程可以拥有 4 GiB 的虚拟空间。</p><p>内核空间故名思议，存放的是内核代码和数据；而用户空间存放的是用的代码和数据，这两部分空间再次强调，都是保存在 <strong>虚拟内存空间之内</strong> 的。内核的数据需要悉心的保护，确保不被未授权第三方获取，Linux Kernel 使用了两层保护机制，即 Ring 0 和 Ring 3.</p><p>用户初始运行一个进程时，运行于 Ring 3（用户态），此时处理器工作在权限最低的 Ring 3, 程序请求提权发出中断信号，进而通过 TRAP 指令调用中断处理程序执行 System Call（系统调用），陷入 Ring 0（内核态）时便拥有了最高权限，执行的内核代码便会调用当前进程的内核栈，每个进程都有自己对应的内核栈。有名的 Rootkit 病毒便大多是提权到 Ring 0 来实现自我保护的。</p><h4 id="题外：那-Ring-1-和-Ring-2-呢？"><a href="#题外：那-Ring-1-和-Ring-2-呢？" class="headerlink" title="题外：那 Ring 1 和 Ring 2 呢？"></a>题外：那 Ring 1 和 Ring 2 呢？</h4><p>X86 架构提供了四层分级保护域，Ring 0 到 Ring 3. Ring 0 具有最高权限，Ring 3 权限最低。Ring 1 大多用于加载虚拟化内核和硬件驱动（例如：VirtualBox Guest Kernel），Ring 2 大多用于加载 I/O 设备相关的驱动和一些被保护的函数库(I/O Privileged Code)，早期的 OS/2 的 Presentation Manager 代码便加载到这一层。个人认为，可以简单的理解为 Ring 1 、 Ring 2 和 Ring 0 的差异可以简化视为描述符不同的 Ring 0 层。</p><h1 id="上下文-Context"><a href="#上下文-Context" class="headerlink" title="上下文 Context"></a>上下文 Context</h1><h2 id="明确相关概念"><a href="#明确相关概念" class="headerlink" title="明确相关概念"></a>明确相关概念</h2><p>上下文：是从英文 Context 翻译过来，指的是一种环境。相对于进程而言，就是进程执行时的环境；具体来说就是各个变量和数据，包括所有的寄存器变量、进程打开的文件、内存信息等。主要分为中断上下文、进程上下文、原子上下文。</p><p>原子： Atom，本意是“不能被进一步分割的最小粒子”，而原子操作 (atomic operation) 意为”不可被中断的一个或一系列操作”。</p><p>原子上下文：内核的一个原则是：在处理 IRQ 过程中、以及持有自旋锁 (spin_lock) 的过程中，内核不能访问用户空间，内核不能调用任何引起睡眠的函数。如果一个进程正在处于上述状态之一，且不能被中断，则称该进程正在进行原子操作，该进程此时对应的上下文为原子上下文。</p><h3 id="原子上下文"><a href="#原子上下文" class="headerlink" title="原子上下文"></a>原子上下文</h3><p>Linux 提供了以下六个宏来判断是否处于原子上下文的情况： <a href="https://elixir.bootlin.com/linux/v5.0.6/source/include/linux/preempt.h#L87" target="_blank" rel="noopener">include/linux/preempt.h Line 87</a></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* * Are we doing bottom half or hardware interrupt processing? * * in_irq()       - We're in (hard) IRQ context * in_softirq()   - We have BH disabled, or are processing softirqs * in_interrupt() - We're in NMI,IRQ,SoftIRQ context or have BH disabled * in_serving_softirq() - We're in softirq context * in_nmi()       - We're in NMI context * in_task()      - We're in task context * * Note: due to the BH disabled confusion: in_softirq(),in_interrupt() really *       should not be used in new code. */</span><span class="token macro property">#<span class="token directive keyword">define</span> in_irq()        (hardirq_count())</span><span class="token macro property">#<span class="token directive keyword">define</span> in_softirq()        (softirq_count())</span><span class="token macro property">#<span class="token directive keyword">define</span> in_interrupt()        (irq_count())</span><span class="token macro property">#<span class="token directive keyword">define</span> in_serving_softirq()    (softirq_count() &amp; SOFTIRQ_OFFSET)</span><span class="token macro property">#<span class="token directive keyword">define</span> in_nmi()        (preempt_count() &amp; NMI_MASK)</span><span class="token macro property">#<span class="token directive keyword">define</span> in_task()        (!(preempt_count() &amp; \                   (NMI_MASK | HARDIRQ_MASK | SOFTIRQ_OFFSET)))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://elixir.bootlin.com/linux/v5.0.6/source/include/linux/preempt.h#L142" target="_blank" rel="noopener">include/linux/preempt.h Line 142</a></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* * Are we running in atomic context?  WARNING: this macro cannot * always detect atomic context; in particular, it cannot know about * held spinlocks in non-preemptible kernels.  Thus it should not be * used in the general case to determine whether sleeping is possible. * Do not use in_atomic() in driver code. */</span><span class="token macro property">#<span class="token directive keyword">define</span> in_atomic()    (preempt_count() != 0)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这些宏访问的地方都是： <code>thread_info-&gt;preempt_count</code> 这些中断计数和抢占计数任何地方返回不为 0 均为原子上下文，禁止违反上面说过的原则。令人奇怪的是，<code>in_atomic()</code> 这个宏提示是 unrealiable 的，为什么呢？</p><blockquote><p>但是，对于 <code>in_atomic()</code> 来说，在启用抢占的情况下，它工作的很好，可以告诉内核目前是否持有自旋锁，是否禁用抢占等。但是，在没有启用抢占的情况下， <code>spin_lock</code> 根本不修改 <code>preempt_count()</code> ，所以即使内核调用了 <code>spin_lock</code> ，持有了自旋锁，<code>in_atomic()</code> 仍然会返回 0，错误的告诉内核目前在非原子上下文中。所以凡是依赖 <code>in_atomic()</code> 来判断是否在原子上下文的代码，在禁止线程抢占的情况下都是不可靠的。具体的显式声明禁止线程抢占由 <code>preempt_disable()</code> 实现。</p></blockquote><h3 id="关于-Linux-Kernel-的-preempt-count"><a href="#关于-Linux-Kernel-的-preempt-count" class="headerlink" title="关于 Linux Kernel 的 preempt_count"></a>关于 Linux Kernel 的 preempt_count</h3><p><code>preempt_count</code> 是 Linux 的线程抢占计数器，不过多深入，之后讲到线程调度和预防死锁的时候我们会详细介绍。具体的 <code>preempt_count</code> 的内容定义在 Linux 内核源代码的这里可以查到：<a href="https://elixir.bootlin.com/linux/v5.0.6/source/include/linux/preempt.h#L13" target="_blank" rel="noopener">include/linux/preempt.h Line 13</a></p><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* * We put the hardirq and softirq counter into the preemption * counter. The bitmask has the following meaning: * * - bits 0-7 are the preemption count (max preemption depth: 256) * - bits 8-15 are the softirq count (max # of softirqs: 256) * * The hardirq count could in theory be the same as the number of * interrupts in the system, but we run all interrupt handlers with * interrupts disabled, so we cannot have nesting interrupts. Though * there are a few palaeontologic drivers which reenable interrupts in * the handler, so we need more than one bit here. * *         PREEMPT_MASK:    0x000000ff *         SOFTIRQ_MASK:    0x0000ff00 *         HARDIRQ_MASK:    0x000f0000 *             NMI_MASK:    0x00100000 * PREEMPT_NEED_RESCHED:    0x80000000 */</span><span class="token macro property">#<span class="token directive keyword">define</span> PREEMPT_BITS    8</span><span class="token macro property">#<span class="token directive keyword">define</span> SOFTIRQ_BITS    8</span><span class="token macro property">#<span class="token directive keyword">define</span> HARDIRQ_BITS    4</span><span class="token macro property">#<span class="token directive keyword">define</span> NMI_BITS    1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>具体的自己看代码注释吧，懒得过多解释了。</p><h2 id="上下文切换简述"><a href="#上下文切换简述" class="headerlink" title="上下文切换简述"></a>上下文切换简述</h2><h3 id="进程上下文"><a href="#进程上下文" class="headerlink" title="进程上下文"></a>进程上下文</h3><p>通过上面的介绍，我们知道处理器总处于下列三种状态的一种：</p><ul><li>内核态，运行于进程上下文，内核代表进程运行于内核空间。</li><li>内核态，运行于中断上下文，内核代表硬件运行于内核空间。</li><li>用户态，运行于用户空间。</li></ul><p>当用户需要请求某个物理设备或系统服务时，就需要通过系统调用使用户程序陷入内核空间后映射对应设备、服务地址到用户空间，才能继续执行。</p><p>相对于进程而言，上下文就是进程执行时的环境。当一个进程在执行时, CPU 的所有寄存器中的值、进程的状态以及堆栈中的内容、优先级、调度信息、审计信息、I/O状态、信号与事件信息等等被称为该进程的上下文，是一种对进程执行活动全过程的静态描述。当内核需要切换到另一个进程时，它需要保存当前进程的所有状态，即保存当前进程的上下文，以便在再次执行该进程时，能够必得到切换时的状态执行下去。在 LINUX 中，当前进程上下文均保存在进程的任务数据结构中。在发生中断时，内核就在被中断进程的上下文中，在内核态下执行中断服务例程。但同时会保留所有需要用到的资源，以便中继服务结束时能恢复被中断进程的执行。一个进程的上下文可以分为三个部分:用户级上下文、寄存器上下文以及系统级上下文。</p><p>（1）用户级上下文: 正文、数据、用户堆栈以及共享存储区；<br>（2）寄存器上下文: 通用寄存器、程序寄存器(IP)、处理器状态寄存器(EFLAGS)、栈指针(ESP)；<br>（3）系统级上下文: 进程控制块 task_struct、内存管理信息(mm_struct、vm_area_struct、pgd、pte)、内核栈。</p><p>当发生进程调度时，进行进程切换就是上下文切换(context switch). 操作系统必须对上面提到的全部信息进行切换，新调度的进程才能运行。而系统调用进行的模式切换(mode switch)。模式切换与进程切换比较起来，容易很多，而且节省时间，因为模式切换最主要的任务只是切换进程寄存器上下文的切换。进程上下文主要保存的内容是异常处理程序与内核线程，在进程上下文中引用 current 是有意义的。上下文切换的一个活动流程是：</p><ul><li>挂起一个进程，将这个进程在 CPU 中的状态（上下文）存储于内存中的某处，</li><li>在内存中检索下一个进程的上下文并将其在 CPU 的寄存器中恢复</li><li>跳转到程序计数器所指向的位置（即跳转到进程被中断时的代码行），以恢复该进程</li></ul><p>由于需要访问 Process Table (Maintained by Kernel)，故 Context Switch 能且仅能在 内核中 进行。</p><h3 id="中断上下文"><a href="#中断上下文" class="headerlink" title="中断上下文"></a>中断上下文</h3><p>硬件通过触发信号，导致内核调用中断处理程序，进入内核空间。这个过程中，硬件的一些变量和参数也要传递给内核，内核通过这些参数进行中断处理。所谓的 “中断上下文” ，其实也可以看作就是硬件传递过来的这些参数和内核需要保存的一些其他环境（主要是当前被打断执行的进程环境）。这样的一个中断信号的发生是 random 的，中断处理和软中断无法预测何时发生、什么设备（进程）触发了这个中断，这样的一种中断，引用 current 可以，但没有意义。而中断时，内核不代表任何进程运行，它一般只访问系统空间，而不会访问进程空间，内核在中断上下文中执行时一般不会阻塞。</p><p>中断上下文是原子上下文的一部分，禁止被抢占，内核禁止其在中断上下文中执行下列操作：</p><ul><li>占用互斥体</li><li>进入睡眠</li><li>执行耗时长的任务</li><li>访问用户空间</li><li>不允许中断处理例程被递归或并行调用</li><li>中断处理例程 <strong>可以被更高级别 IRQ 中断</strong></li></ul><p>常见的一个例子是：A 进程期待一个 I/O 写完成中断，实际在 B 进程执行、A 进程睡眠时发生。此时的中断信号打断 B 进程，唤醒 A 进程。</p><h2 id="Linux-Kernel-的上下文切换-context-switch-实现"><a href="#Linux-Kernel-的上下文切换-context-switch-实现" class="headerlink" title="Linux Kernel 的上下文切换 context_switch 实现"></a>Linux Kernel 的上下文切换 context_switch 实现</h2><p>Linux Kernel 的上下文切换需要详细了解 Linux 内核调度器，迫于时间压力，先暂时把内核源码放在这里，有时间的话在慢慢深究。</p><p><a href="https://elixir.bootlin.com/linux/v5.0.6/source/kernel/sched/core.c#L2859" target="_blank" rel="noopener">kernel/sched/core.c Line 2859: context_switch</a></p><p><a href="https://elixir.bootlin.com/linux/latest/source/include/linux/sched.h" target="_blank" rel="noopener">include/linux/sched.h Line 72: task_struct</a></p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><h4 id="各类博客"><a href="#各类博客" class="headerlink" title="各类博客"></a>各类博客</h4><p><a href="https://www.cnblogs.com/openix/archive/2013/03/09/2952057.html" target="_blank" rel="noopener">https://www.cnblogs.com/openix/archive/2013/03/09/2952057.html</a><br><a href="https://www.21qa.net/questions/167/167" target="_blank" rel="noopener">https://www.21qa.net/questions/167/167</a><br><a href="http://www.cnblogs.com/Anker/p/3269106.html" target="_blank" rel="noopener">http://www.cnblogs.com/Anker/p/3269106.html</a><br><a href="https://blog.csdn.net/zqixiao_09/article/details/50877756" target="_blank" rel="noopener">https://blog.csdn.net/zqixiao_09/article/details/50877756</a><br><a href="https://blog.csdn.net/gatieme/article/details/51872659" target="_blank" rel="noopener">https://blog.csdn.net/gatieme/article/details/51872659</a><br><a href="http://blog.sungju.org/2015/11/17/whats-virtual-address-limit-of-32bit64bit-linux-kernel-2/" target="_blank" rel="noopener">http://blog.sungju.org/2015/11/17/whats-virtual-address-limit-of-32bit64bit-linux-kernel-2/</a><br><a href="http://compgroups.net/comp.lang.asm.x86/privilege-levels-1-and-2/162524" target="_blank" rel="noopener">http://compgroups.net/comp.lang.asm.x86/privilege-levels-1-and-2/162524</a><br><a href="https://blog.csdn.net/baidu_17062867/article/details/37744863" target="_blank" rel="noopener">https://blog.csdn.net/baidu_17062867/article/details/37744863</a></p><h4 id="专业的问答网站和第三方文档"><a href="#专业的问答网站和第三方文档" class="headerlink" title="专业的问答网站和第三方文档"></a>专业的问答网站和第三方文档</h4><p><a href="https://linux-kernel-labs.github.io" target="_blank" rel="noopener">https://linux-kernel-labs.github.io</a><br><a href="https://stackoverflow.com/questions/19349572/why-do-we-need-virtual-memory" target="_blank" rel="noopener">https://stackoverflow.com/questions/19349572/why-do-we-need-virtual-memory</a><br><a href="https://en.wikipedia.org/wiki/Virtual_memory" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Virtual_memory</a><br><a href="https://support.symantec.com/en_US/article.TECH244351.html" target="_blank" rel="noopener">https://support.symantec.com/en_US/article.TECH244351.html</a><br><a href="https://en.wikibooks.org/wiki/The_Linux_Kernel/Memory" target="_blank" rel="noopener">https://en.wikibooks.org/wiki/The_Linux_Kernel/Memory</a><br><a href="http://tldp.org/HOWTO/KernelAnalysis-HOWTO-7.html" target="_blank" rel="noopener">http://tldp.org/HOWTO/KernelAnalysis-HOWTO-7.html</a><br><a href="https://stackoverflow.com/questions/6710040/cpu-privilege-rings-why-rings-1-and-2-arent-used" target="_blank" rel="noopener">https://stackoverflow.com/questions/6710040/cpu-privilege-rings-why-rings-1-and-2-arent-used</a><br><a href="https://unix.stackexchange.com/questions/87625/what-is-difference-between-user-space-and-kernel-space" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/87625/what-is-difference-between-user-space-and-kernel-space</a><br><a href="https://en.wikipedia.org/wiki/Context_switch" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Context_switch</a><br><a href="https://www.quora.com/Does-context-switching-happen-in-the-the-kernel-mode" target="_blank" rel="noopener">https://www.quora.com/Does-context-switching-happen-in-the-the-kernel-mode</a></p><h4 id="Linux-内核源代码"><a href="#Linux-内核源代码" class="headerlink" title="Linux 内核源代码"></a>Linux 内核源代码</h4><p><a href="https://elixir.bootlin.com/linux/v5.0.6/source" target="_blank" rel="noopener">https://elixir.bootlin.com/linux/v5.0.6/source</a></p><p>引用的图片和文字版权归原作者所有</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>操作系统原理 - 有限状态机</title>
    <link href="https://www.kmahyyg.xyz/2019/os-fsm/"/>
    <id>https://www.kmahyyg.xyz/2019/os-fsm/</id>
    <published>2019-04-07T20:05:37.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本学期的重点之一就是这一门操作系统课程。这个系列的文章会一直坚持写下去，记录我在学习过程中不断探索、询问的过程。</p><p>今天是这个系列的第一篇文章，讲述有限状态机，有限状态机为后面的多线程与进程调度做下铺垫。</p><p>本系列的所有文章的代码均在 GNU GCC 8.2.1 下编译通过，本地使用的 Linux Kernel 为 5.0.6 及以上版本，跟随 Arch Linux 稳定 core 仓库更新。 <strong>不提供 Windows 支持。</strong></p><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p><img src="https://alicdn.kmahyyg.xyz/asset_files/fsm_01_ryf.webp" alt="FSM RYF"></p><p>定义：有限状态机（英语：finite-state machine，缩写：FSM）又称有限状态自动机，简称状态机，是表示有限个状态以及在这些状态之间的转移和动作等行为的数学模型。</p><p>简单说，它有三个特征：</p><ul><li>状态总数（state）是有限的。</li><li>任一时刻，只处在一种状态之中。</li><li>某种条件下（当前 state + 特定 event），会从一种状态转变（transition）到另一种状态。</li></ul><p>对，就是这么简单。</p><h2 id="FSM-的几种实现"><a href="#FSM-的几种实现" class="headerlink" title="FSM 的几种实现"></a>FSM 的几种实现</h2><h3 id="if-else-实现"><a href="#if-else-实现" class="headerlink" title="if+else 实现"></a>if+else 实现</h3><p>大量的 <code>if</code> <code>else if</code> <code>else</code> 语句，程序简单易懂，但是代码执行效率不高，过于低端的同时造成了代码膨胀。如果状态的较少可以采用，但如果状态很多，就非常难受了。这类实现是我们这类初学者经常采用的。</p><h3 id="case-switch-实现"><a href="#case-switch-实现" class="headerlink" title="case+switch 实现"></a>case+switch 实现</h3><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">switch</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">case</span> status1<span class="token punctuation">:</span>        <span class="token function">dosth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        state <span class="token operator">=</span> status2<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> status2<span class="token punctuation">:</span>        <span class="token function">dosth2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        state <span class="token operator">=</span> status3<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">default</span><span class="token punctuation">:</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样的实现较上一种实现方法看起来简洁很多，代码执行效率有所提高，但主要存在两个问题：（1）规模难以扩大和维护  （2）忘写 <code>break;</code> 可能造成灾难性后果。所以也不推荐在大型项目或者操作系统层面使用。</p><h3 id="FSM-表实现"><a href="#FSM-表实现" class="headerlink" title="FSM 表实现"></a>FSM 表实现</h3><p>使用函数指针实现 FSM 的思路：建立相应的状态表和动作查询表，根据状态表、事件、动作表定位相应的动作处理函数，执行完成后再进行状态的切换。</p><p>当然使用函数指针实现的 FSM 的过程还是比较费时费力，但是这一切都是值得的，因为当你的程序规模大的时候，基于这种表结构的状态机，维护程序起来也是得心应手。</p><pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token keyword">void</span> <span class="token function">haltmc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// define what to do when triggered</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Machine halted...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">pwron</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Powered on.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">postchk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"POST Successfully finished. Hardware OK!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">start_os</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Trying to boot up with kernel...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Kernel prepared for calling up DE...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">user_clickoff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"DE called up and running smoothly.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"User clicked to power off...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Software stopped...Disassembling stacked devices...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">haltmc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">enum</span> <span class="token punctuation">{</span>    POWER_ON<span class="token punctuation">,</span>    POST<span class="token punctuation">,</span>    INITIALIZE<span class="token punctuation">,</span>    USER_TURN_OFF<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// EVENTS</span><span class="token keyword">enum</span> <span class="token punctuation">{</span>    POST_DONE<span class="token punctuation">,</span>    STARTED<span class="token punctuation">,</span>    USER_OFF<span class="token punctuation">,</span>    HALTED<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// STATUS</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> fsmtb_s <span class="token punctuation">{</span>    <span class="token keyword">int</span> event<span class="token punctuation">;</span>    <span class="token keyword">int</span> currstatus<span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>dosth<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> nextstatus<span class="token punctuation">;</span><span class="token punctuation">}</span> fsmtb_t<span class="token punctuation">,</span> <span class="token operator">*</span>fsmtb_ptr<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// fsm status table</span>fsmtb_t PCRUN<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// coming event, current status, to do sth, next status</span>        <span class="token punctuation">{</span>POWER_ON<span class="token punctuation">,</span>      HALTED<span class="token punctuation">,</span>       pwron<span class="token punctuation">,</span>         POST_DONE<span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>POST<span class="token punctuation">,</span>          POST_DONE<span class="token punctuation">,</span>    postchk<span class="token punctuation">,</span>       STARTED<span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>INITIALIZE<span class="token punctuation">,</span>    STARTED<span class="token punctuation">,</span>      start_os<span class="token punctuation">,</span>      USER_OFF<span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>USER_TURN_OFF<span class="token punctuation">,</span> USER_OFF<span class="token punctuation">,</span>     user_clickoff<span class="token punctuation">,</span> HALTED<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> fsm_s <span class="token punctuation">{</span>    fsmtb_ptr fsm_status_tb<span class="token punctuation">;</span>    <span class="token keyword">int</span> currstatus<span class="token punctuation">;</span><span class="token punctuation">}</span>fsm_t<span class="token punctuation">,</span> <span class="token operator">*</span>fsm_ptr<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// machine status</span><span class="token keyword">int</span> max_state_tb<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// max status in the status table</span><span class="token keyword">void</span> <span class="token function">initMC</span><span class="token punctuation">(</span>fsm_ptr machine<span class="token punctuation">)</span><span class="token punctuation">{</span>    max_state_tb <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PCRUN<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>fsmtb_t<span class="token punctuation">)</span><span class="token punctuation">;</span>    machine<span class="token operator">-></span>currstatus <span class="token operator">=</span> HALTED<span class="token punctuation">;</span>    machine<span class="token operator">-></span>fsm_status_tb <span class="token operator">=</span> PCRUN<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// link status table to machine</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">FSMNext</span><span class="token punctuation">(</span>fsm_ptr machine<span class="token punctuation">,</span> <span class="token keyword">int</span> state<span class="token punctuation">)</span><span class="token punctuation">{</span>    machine<span class="token operator">-></span>currstatus <span class="token operator">=</span> state<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">FSMHandle</span><span class="token punctuation">(</span>fsm_ptr machine<span class="token punctuation">,</span> <span class="token keyword">int</span> event<span class="token punctuation">)</span><span class="token punctuation">{</span>    fsmtb_ptr actTable <span class="token operator">=</span> machine<span class="token operator">-></span>fsm_status_tb<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// bind the whole status</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>eventAct<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// init a do something function ptr</span>    <span class="token keyword">int</span> nextStatus<span class="token punctuation">;</span>    <span class="token keyword">int</span> currentStatus <span class="token operator">=</span> machine<span class="token operator">-></span>currstatus<span class="token punctuation">;</span>    <span class="token keyword">int</span> done <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> max_state_tb<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        fsmtb_ptr currentActTable <span class="token operator">=</span> <span class="token operator">&amp;</span>actTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// trying to recursive read the status table</span>        <span class="token comment" spellcheck="true">// and check if the status and event is corresponding: if true, dosth()</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">==</span> currentActTable<span class="token operator">-></span>event <span class="token operator">&amp;&amp;</span> currentStatus <span class="token operator">==</span> currentActTable<span class="token operator">-></span>currstatus<span class="token punctuation">)</span><span class="token punctuation">{</span>            done <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            eventAct <span class="token operator">=</span> currentActTable<span class="token operator">-></span>dosth<span class="token punctuation">;</span>            nextStatus <span class="token operator">=</span> currentActTable<span class="token operator">-></span>nextstatus<span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">// if status-event pair is satisfied</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>eventAct<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// if action is not null</span>            <span class="token function">eventAct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">FSMNext</span><span class="token punctuation">(</span>machine<span class="token punctuation">,</span> nextStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// if done, transfer to next status</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">void</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// do nothing</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">gogogo</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>evnt<span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">// manually trigger the event</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>evnt <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">*</span>evnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token operator">*</span>evnt<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    fsm_t machine<span class="token punctuation">;</span>    <span class="token function">initMC</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>machine<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> startevnt <span class="token operator">=</span> POWER_ON<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// printf("EVENT 0: 开机, 1: 自检，2：加载，3: 用户关闭 \n");</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"----------------------------------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Event %d is coming...\n"</span><span class="token punctuation">,</span> startevnt<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">FSMHandle</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>machine<span class="token punctuation">,</span> startevnt<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// printf("STATUS 0: 自检完成，1: 开机运行，2: 用户关闭，3: 已关闭\n");</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Current Status is %d...\n"</span><span class="token punctuation">,</span> machine<span class="token punctuation">.</span>currstatus<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"----------------------------------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">gogogo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>startevnt<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>阅读代码可以看出，当且仅当在指定的状态下来了指定的事件才会发生函数的执行以及状态的转移，否则不会发生状态的跳转。这种机制使得这个状态机不停地自动运转，有条不絮地完成任务。</p><p>与前两种方法相比，使用函数指针实现FSM能很好用于大规模的切换流程，只要我们实现搭好了FSM框架，以后进行扩展就很简单了（只要在状态表里加一行来写入新的状态处理就可以了）。</p><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://www.ruanyifeng.com/blog/2013/09/finite-state_machine_for_javascript.html" target="_blank" rel="noopener">https://www.ruanyifeng.com/blog/2013/09/finite-state_machine_for_javascript.html</a><br><a href="https://zh.wikipedia.org/wiki/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA</a><br><a href="http://www.cnblogs.com/skyfsm/p/7071386.html" target="_blank" rel="noopener">http://www.cnblogs.com/skyfsm/p/7071386.html</a><br><a href="https://github.com/AstarLight/FSM-framework" target="_blank" rel="noopener">https://github.com/AstarLight/FSM-framework</a></p><p>图片版权归原作者所有</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>2019 新年之旅 - 重庆 Day 3</title>
    <link href="https://www.kmahyyg.xyz/2019/cqcd-trip-cqday3/"/>
    <id>https://www.kmahyyg.xyz/2019/cqcd-trip-cqday3/</id>
    <published>2019-04-07T16:32:33.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="写在正文之前"><a href="#写在正文之前" class="headerlink" title="写在正文之前"></a>写在正文之前</h2><p>去玩回来一直咕到现在，最近的事情真的非常的多。</p><p>预告一下最近打算更新的一些内容：</p><ul><li>补完旅行记录</li><li>图像识别与处理的作业和踩的坑</li><li>数据库课程的一些个人认为的”Best Practice”（基于 MariaDB，很大概率会咕）</li><li>操作系统概念课程的一些难点和实验文档</li></ul><hr><h1 id="重庆"><a href="#重庆" class="headerlink" title="重庆"></a>重庆</h1><h2 id="Day-3-早晨"><a href="#Day-3-早晨" class="headerlink" title="Day 3 - 早晨"></a>Day 3 - 早晨</h2><p>鉴于中午过了之后便要连忙赶去高铁站乘坐当天下午的高铁前往成都。时间安排非常紧张的前提下，今天反而是相对悠闲的一天。</p><p>重庆人始终对于豌杂小面有一种莫名的执着，在临走之前不妨去尝试一下重庆赫赫有名的花市豌杂面，一碗人气腾腾却又麻辣到你的五脏六腑的小面上来。驱走了早上蒙蒙细雨带来的丝丝凉意。对于这样一个常年阴霾下的城市，也算是因地制宜吧。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-1.jpg" alt="CQWZM"></p><p>吃过早饭之后前往山城步道，感受老重庆那一点点遗留下来的一份“山城味”。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-2.jpg" alt="CQSZBD1"></p><p>山城步道入口</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-3.jpg" alt="CQSZBD2"></p><p>后翻新的山城巷入口</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-4.jpg" alt="CQSZBD3"></p><p>方行数十步</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-5.jpg" alt="CQSZBD4"><br><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-6.jpg" alt="CQSZBD5"></p><p>山城步道的标记</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-7.jpg" alt="CQSZBD6"></p><p>山城步道内一景，老重庆生活的象征</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-8.jpg" alt="CQSZBD7"></p><p>传说中的空中栈道，向下俯瞰可以看到长江流过形成泥沙阻塞形成的小岛和长江大桥。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-13.jpg" alt="CQSZBD8"></p><p>俯瞰全景</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-9.jpg" alt="CQSZBD9"></p><p>当时天气不太好，湿气很重、雾蒙蒙的，给人一种山雨欲来风满楼的感觉。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-10.jpg" alt="CQSZBD10"></p><p>山城步道一处壁画</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-11.jpg" alt="CQSZBD11"></p><p>能想到下面是什么吗？其实是一座假山状的变电厂。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day3/2019cq-d3-12.jpg" alt="CQSZBD12"></p><p>难寻踪迹的出口</p><h2 id="Day-3-中午"><a href="#Day-3-中午" class="headerlink" title="Day 3 - 中午"></a>Day 3 - 中午</h2><p>在绕过了假山之后，我们找到了出口。过了出口之后的路并破败不堪，且窄且脏，让人难以下脚。最终走向了一个看守所的出口，在那里，有一些当地的民众还在用传统的方法制作烟熏肉。卫生条件十分堪忧。</p><p>差不多走到公路的时候已经接近 11：00, 速度回到住处，准备退房，退房后在去高铁站的中途吃了牛汤锅。然后到了高铁站，又开始犯饿，迫于 14：00 的高铁大约到成都是 19：00，又大吃了一顿 BurgerKing.</p><p>结束，下一站成都。</p><p>The END</p><p>Rev.1 2019.4.7 于 学校宿舍</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Personal" scheme="https://www.kmahyyg.xyz/tags/Personal/"/>
    
  </entry>
  
  <entry>
    <title>Java 语言笔记 - 控制流程</title>
    <link href="https://www.kmahyyg.xyz/2019/Java-ControlProc/"/>
    <id>https://www.kmahyyg.xyz/2019/Java-ControlProc/</id>
    <published>2019-03-30T15:20:58.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="Java-语言笔记-控制流程"><a href="#Java-语言笔记-控制流程" class="headerlink" title="Java 语言笔记 - 控制流程"></a>Java 语言笔记 - 控制流程</h1><p>Last Edited: Mar 30, 2019 3:20 PM</p><ol><li>关于变量的生命周期与重定义问题</li></ol><p>每一 Block 之内的变量只能定义一次，只在当前 Block 及其子 Block 内有效，且不能重复定义。</p><ol start="2"><li>关于判断与循环</li></ol><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">while</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span> statement<span class="token punctuation">;</span>    <span class="token keyword">do</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i≤<span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// Please Note: DON'T DETECT FLOATING VALUE.</span>    <span class="token keyword">switch</span><span class="token punctuation">(</span>choice<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>请不要在 for 循环中检测终止使用浮点数，因为可能因为二进制浮点数在计算机中的保存问题造成死循环。</p><ol start="3"><li>带标签的 break 语句</li></ol><pre class="line-numbers language-java"><code class="language-java">    label<span class="token operator">:</span>  <span class="token punctuation">{</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token keyword">break</span> label<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// jump back to the first line of the block</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// jump here when the break statements executes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>Java 语言笔记 - 字符串与输入输出流</title>
    <link href="https://www.kmahyyg.xyz/2019/Java-STDnSTR/"/>
    <id>https://www.kmahyyg.xyz/2019/Java-STDnSTR/</id>
    <published>2019-03-30T14:39:29.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="Java-语言笔记-字符串与输入输出流"><a href="#Java-语言笔记-字符串与输入输出流" class="headerlink" title="Java 语言笔记 - 字符串与输入输出流"></a>Java 语言笔记 - 字符串与输入输出流</h1><p>Last Edited: Mar 30, 2019 2:39 PM</p><p>一、字符串</p><p>(1) 定义</p><p>字符串的识别和 C 中完全相同，“” 表示一个字符串，‘’表示一个字符，并且字符串的保存采用的是 Unicode 序列的形式。</p><p>(2) 字符串 String 类的各个方法</p><pre class="line-numbers language-java"><code class="language-java">    String e <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">;</span>    String greeting <span class="token operator">=</span> <span class="token string">"Hello world!"</span><span class="token punctuation">;</span>    String s <span class="token operator">=</span> greeting<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// return Hel</span>    String message <span class="token operator">=</span> e <span class="token operator">+</span> greeting<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Connect two strings</span>    <span class="token comment" spellcheck="true">// Java 的字符串一旦定义就不可变，如果你需要修改，应当截取子串后拼接</span>    <span class="token string">"Hello"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">// 不可以用 ==</span>    <span class="token string">"Hello"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"Hello w"</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">// 检测字符串是否相同，只有字符串常量可以共享，操作后的结果不是共享的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>具体的 API 官方文档，请参见： </p><p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html" target="_blank" rel="noopener">String (Java Platform SE 8 )</a></p><p>(3) 代码点和代码单元</p><p>每一个字串中的字符都是一个代码单元，常用的 Unicode 字符只占用 <strong>1 个 char</strong>，部分字符需要占用 <strong>2 个 char</strong>：</p><pre class="line-numbers language-java"><code class="language-java">    String greeting <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> n <span class="token operator">=</span> greeting<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// return 5</span>    <span class="token keyword">int</span> cpcount <span class="token operator">=</span> greeting<span class="token punctuation">.</span><span class="token function">codePointCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> greeting<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>返回特定位置的代码单元和代码点：</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">char</span> first <span class="token operator">=</span> greeting<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// return 'H'</span>    <span class="token keyword">int</span> index <span class="token operator">=</span> greeting<span class="token punctuation">.</span><span class="token function">offsetByCodePoints</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 获取第4个代码点(Start from 0)</span>    <span class="token keyword">int</span> cp <span class="token operator">=</span> greeting<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://alicdn.kmahyyg.xyz/asset_files/2019-java-stdnstr1.webp" alt></p><p>有的朋友可能会问了：这个玩意貌似没啥卵用啊？请看下面这个例子。</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token comment" spellcheck="true">// Character.isSupplementaryCodePoint();   Return Boolean</span>    <span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span>StandardCharsets<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0xF0</span><span class="token punctuation">,</span>                                      <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0x90</span><span class="token punctuation">,</span>                                      <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0x8A</span><span class="token punctuation">,</span>                                      <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0xB7</span><span class="token punctuation">}</span><span class="token punctuation">;</span>            String string <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    String greeting <span class="token operator">=</span> <span class="token string">"\uD800\uDEB7 is a mountain."</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">// https://www.fileformat.info/info/unicode/char/102b7/index.htm</span>                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> cp <span class="token operator">=</span> greeting<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Character<span class="token punctuation">.</span><span class="token function">isSupplementaryCodePoint</span><span class="token punctuation">(</span>cp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token comment" spellcheck="true">// 辅助字符的第一部分则返回 True</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://alicdn.kmahyyg.xyz/asset_files/2019-java-stdnstr2.webp" alt></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/2019-java-stdnstr3.webp" alt></p><p>(4) StringBuilder</p><p>使用字符串拼接的方式构建的字符串，浪费空间、效率极低，所以 Java 提供了 StringBuilder 类来尽可能的提高效率。</p><p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/StringBuilder.html" target="_blank" rel="noopener">StringBuilder (Java Platform SE 8 )</a></p><pre class="line-numbers language-java"><code class="language-java">    StringBuilder builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Hi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    String hel <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>二、输入输出流</p><p>(1) STDIN</p><p>Java 使用的类不再属于基本包 java.lang 时，需要手动导入</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>*<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Inpout</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>            Scanner in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Bind stdin to scanner</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"What is your name?"</span><span class="token punctuation">)</span>            String name <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// Get user input as a line, stop with LF</span>            String middle_name <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// Get user input as a word, stop with space</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"How old are you?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> age <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// Get user input as an integer</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Scanner.html" target="_blank" rel="noopener">Scanner (Java Platform SE 8 )</a></p><p>如果用户需要使用控制台或者输入密码等操作，请参考下列官方文档：</p><p>常用的方法有： java.lang.System.console();  java.io.Console.readPassword(String prompt, Object … args); java.io.Console.readLine(String prompt, Object … args);</p><p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/System.html" target="_blank" rel="noopener">System (Java Platform SE 8 )</a></p><p>(2) STDOUT</p><ul><li>1 格式化输出</li></ul><p>Java 的格式化输出基本上沿用了 C 的格式化模式，常见的转换符有如下几个：</p><p>%d int, %x Hex, %o Octet, %f FixedFloat, %e 10^x, %g Float, %a HexFloat, %s String</p><p>%c char, %b Boolean, %h hash, %t* Time, %% %, %n Related to platform.</p><p>下列字符可用于格式化输出中的对齐或使用标准格式</p><p>%+ 正负号，%<space> 添加空格 ， %0 数字前补0，%- 左对齐，</space></p><p>%( 将负数括在括号内，%<comma> 添加分组分隔符， %#f 包含小数点，</comma></p><p>%#x 添加前缀0x，%1$d 以十进制整数打印第一个参数，%d%&lt;x 表示以十进制和十六进制打印同一个数值。</p><p>下列字符可用于格式化时间输出：</p><p><a href="https://dzone.com/articles/java-string-format-examples" target="_blank" rel="noopener">Java String Format Examples - DZone Java</a></p><ul><li>2 文件输入输出</li></ul><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throw</span> FileNotFoundException<span class="token punctuation">{</span>        Scanner in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:\\hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// You need to use \\ to represent \, / doesn't need escape</span>        PrintWriter out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"/tmp/hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String cwd <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>Java 语言笔记 - 基础的程序设计结构</title>
    <link href="https://www.kmahyyg.xyz/2019/Java-BasicDesignProg/"/>
    <id>https://www.kmahyyg.xyz/2019/Java-BasicDesignProg/</id>
    <published>2019-03-26T08:41:09.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="Java-语言笔记-基础的程序设计结构"><a href="#Java-语言笔记-基础的程序设计结构" class="headerlink" title="Java 语言笔记 - 基础的程序设计结构"></a>Java 语言笔记 - 基础的程序设计结构</h1><p>Last Edited: Mar 26, 2019 8:41 AM</p><ol><li>基本的程序设计结构</li></ol><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FirstSample</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>“hello world”<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>public - 访问修饰符，控制访问权限</p><p>class - 表明 Java 程序中的全部内容包含在类中，类是加载程序逻辑的容器，定义了应用程序的行为。Java应用程序的全部内容必须放置在类中。</p><p>class 后紧跟类名，不可使用保留字，推荐命名方法为驼峰命名。源代码命名与类名相同。</p><p>注释使用与 C 语言相同的注释符号，不同的是禁止嵌套注释符号。</p><ol start="2"><li>数据类型</li></ol><p>Java 的数据类型分为 8 种基本类型（primitive type），剩下的都是 reference type.</p><p>int - 4 Bytes - 2^32</p><p>short - 2 Bytes - 2^16</p><p>long - 8 Bytes - 2^64</p><p>byte - 1 Byte - 2^8</p><p>float - 4 Bytes - 3.4E+38F</p><p>double - 8 Bytes - 1.79E+308D</p><p>Double.POSITIVE_INFINITY, Double.NEGATIVE_INFINITY, Double.NaN</p><p>char - 单个字符， ‘’ 包围</p><ol start="3"><li>常用转义及对应 Unicode</li></ol><p>\b - Backspace - \u0008       \” - “ -\u022      \’ - ‘ - \u0027</p><p>\r - CR - \u000d      \ - 反斜杠 - \u005e       \t - Tab - 制表符</p><p>\n - LF - \u000a </p><p>Boolean, false/true     </p><p>Standard: UTF-16</p><ol start="3"><li>变量与常量</li></ol><p>Java 当中保留关键字包括 const 和 goto，</p><blockquote><ol><li>Keywords: Keywords has special meaning (functionality) to the compiler. For this reason they cannot be used as identifiers in coding.</li><li>Reserved words: When Java was developed Designers wanted to eliminate two words const and goto. Thinking so, they removed them from the Java language and released the first version JDK 1.0 (in the year 1995). But still they were doubtful whether a language can exist without these two words in future; in the sense, they may be required in future versions. For this reason, const and goto were placed in reserved list. That is, they may be brought back into the Java language anytime in future. Right now as on JDK 1.8, Java proved a language can exist without these two words.<br>Of course, const place is taken by final keyword in Java. goto is against to structured programming language where with goto, the Programmer looses control over the flow or the structure of coding.</li><li>Literals: The literals also cannot be used as identifiers but can be given as values to identifiers.</li></ol></blockquote><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">double</span> salary <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// Initialize can be discreted with Declarartion within the same file</span>    <span class="token keyword">int</span> vacationDays<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// cannot use reserved chars, </span>    <span class="token comment" spellcheck="true">// java.Character.isJavaIndentifierStart , isJavaIdentifierPart</span>    <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// both are integers</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Java 中使用关键字 final 声明常量，表示仅可被赋值一次。 声明的不同位置决定了他的生命周期。下面以声明为类常量为例。</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Constants2</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">double</span> paperWidth <span class="token operator">=</span> <span class="token number">8.5</span><span class="token punctuation">;</span>            <span class="token keyword">double</span> paperHeight <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Fuck you!"</span> <span class="token operator">+</span> CM_PER_INCH<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">double</span> CM_PER_INCH <span class="token operator">=</span> <span class="token number">2.54</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>运算符</li></ol><p>JVM 对于浮点运算采取 64 Bits 必须截断的做法，但对于中间运算结果允许采用扩展的精度。可以采用下列方法来表示必须采用严格的浮点计算。</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">strictfp</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>(1) 关于自增自减</p><pre class="line-numbers language-c"><code class="language-c">    <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">7</span> <span class="token punctuation">;</span>    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">7</span> <span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token operator">++</span>m<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// now a == 16, m == 8</span>    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> n<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// now b == 14, n == 8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>(2) 关于 Boolean 运算</p><p>Java 包含多个关系运算符，大致上完全沿用了 C 语言的习惯且按照 “短路” 方式计算。当第一部分可以确定整个表达式的值时，后面的部分将自动不予计算。</p><p>三元操作： <code>condition ? exp1 : exp2</code> 当 condition == True 时执行 exp1, 否则执行 exp2</p><p>(3) 关于移位运算</p><p>&amp; and, | or, ^ XOR, ~ NOT</p><blockquote><blockquote><p>右移 1 位， &lt;&lt; 左移1 位</p></blockquote></blockquote><blockquote><blockquote><blockquote><p>运算符用 0 填充高位，&gt;&gt; 用符号位填充高位，没有 &lt;&lt;&lt;</p></blockquote></blockquote></blockquote><p>(4) 关于引入的常量</p><p>对于常用的常量，Pi、e，可以采用下列方法使用：</p><ol><li>Math.Pi, Math.E</li><li><pre class="line-numbers language-java"><code class="language-java"> <span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Math<span class="token punctuation">.</span>*<span class="token punctuation">;</span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello, "</span> <span class="token operator">+</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>PI<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><p>(5) 关于类型转换： 与 C 语言完全相同</p><p>(6) 关于括号和运算符级别</p><p><a href="https://alicdn.kmahyyg.xyz/asset_files/2019-java-basicdesign01.csv" target="_blank" rel="noopener">括号和运算符级别（按照给出顺序作为优先级）</a></p><p>(7) enum</p><p>示例：定义一个 Size 类型，使用 enum 表示枚举。</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">enum</span> Size <span class="token punctuation">{</span>SMALL<span class="token punctuation">,</span> MEDIUM<span class="token punctuation">,</span> LARGE<span class="token punctuation">,</span> EXTRA_LARGE<span class="token punctuation">}</span><span class="token punctuation">;</span>    Size s <span class="token operator">=</span> Size<span class="token punctuation">.</span>MEDIUM<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Size 类型只能存储声明的 enum 值和 null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>Dolphin 添加右键菜单解压 Windows 打包的 Zip 文件</title>
    <link href="https://www.kmahyyg.xyz/2019/dolphin-gbkunzip/"/>
    <id>https://www.kmahyyg.xyz/2019/dolphin-gbkunzip/</id>
    <published>2019-03-07T08:51:00.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>代码来源： <a href="https://github.com/farseerfc/dotfiles" target="_blank" rel="noopener">https://github.com/farseerfc/dotfiles</a>  （非常感谢教授~）</p><p>问题原因： Windows 打包的 Zip 文件默认采用 GBK 编码，与 Ark 默认的编码 UTF-8 冲突。</p><p>（PS. 如果您使用 Gnome 桌面环境搭配 Nautilus，请您查看代码来源下载对应的代码文件。）</p><p>解决办法： 使用 farseerfc 写的右键菜单快捷方式解码。</p><p>环境： KDE Plasma + Arch Linux</p><p>代码：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">mkdir</span> -p ~/.local/share/kservices5/ServiceMenus<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将下列代码保存为 <code>unzip.desktop</code> 保存到上述文件夹内：</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token punctuation">[</span>Desktop Entry<span class="token punctuation">]</span>Type=ServiceServiceTypes=KonqPopupMenu/PluginMimeType=application/zip;application/x<span class="token punctuation">-</span>zip<span class="token punctuation">-</span>compressed;application/octet<span class="token punctuation">-</span>stream;Actions=unzipsjis;unzipgbk;X<span class="token punctuation">-</span>KDE<span class="token punctuation">-</span>Submenu=Unzip as<span class="token punctuation">[</span>Desktop Action unzipsjis<span class="token punctuation">]</span>Name=Unzip here shift<span class="token punctuation">-</span>jisIcon=application<span class="token punctuation">-</span>zipExec="unzip" "<span class="token punctuation">-</span>O" "sjis" "%U"<span class="token punctuation">[</span>Desktop Action unzipgbk<span class="token punctuation">]</span>Name=Unzip here GBKIcon=application<span class="token punctuation">-</span>zipExec="unzip" "<span class="token punctuation">-</span>O" "gb18030" "%U"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">chmod</span> +x ~/.local/share/kservices5/ServiceMenus/unzip.deskstop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>大功告成！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Tech" scheme="https://www.kmahyyg.xyz/tags/Tech/"/>
    
  </entry>
  
  <entry>
    <title>Golang 学习笔记</title>
    <link href="https://www.kmahyyg.xyz/2019/golang01/"/>
    <id>https://www.kmahyyg.xyz/2019/golang01/</id>
    <published>2019-02-24T21:19:21.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>课程 <a href="https://time.geekbang.org/column/112" target="_blank" rel="noopener">https://time.geekbang.org/column/112</a></p><h2 id="学习路线"><a href="#学习路线" class="headerlink" title="学习路线"></a>学习路线</h2><p><img src="https://alicdn.kmahyyg.xyz/asset_files/golang/1.png" alt="1.png"></p><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p><img src="https://alicdn.kmahyyg.xyz/asset_files/golang/2.jpg" alt="2.jpg"></p><h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><p>我将使用 <a href="https://www.notion.so/kmahyyg/Golang-Learning-Notes-aacf3c92f4d7452f8b27881bf1856eda" target="_blank" rel="noopener">Notion.so</a> 完成后续笔记。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Tech" scheme="https://www.kmahyyg.xyz/tags/Tech/"/>
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>2019 新年之旅 - 重庆 Day 2</title>
    <link href="https://www.kmahyyg.xyz/2019/cqcd-trip-cqday2/"/>
    <id>https://www.kmahyyg.xyz/2019/cqcd-trip-cqday2/</id>
    <published>2019-02-24T20:36:28.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="写在正文之前"><a href="#写在正文之前" class="headerlink" title="写在正文之前"></a>写在正文之前</h2><p>刚刚在 <a href="https://www.douyu.com/12479" target="_blank" rel="noopener">洛洛的直播间</a> 参与了一场“解答之书”，一直在等待的一个 PopUp， 得到的答案却是“或许不是问题”，那就果断一些吧。 <del>始终在等待那一个 PopUp，看看开学之后一周内会有么…这也就是我留给自己的 Grace Period 了： 1 Week.</del>  已经完全分开，88.</p><hr><h1 id="重庆"><a href="#重庆" class="headerlink" title="重庆"></a>重庆</h1><h2 id="Day-2-早晨"><a href="#Day-2-早晨" class="headerlink" title="Day 2 - 早晨"></a>Day 2 - 早晨</h2><h3 id="春森路"><a href="#春森路" class="headerlink" title="春森路"></a>春森路</h3><p>借着早晨爽朗的阳光，我和同伴分道扬镳，前往了不同的目的地。在地图上确认了一下距离之后，走向了今天意外的第一站：春森路社区。这个社区的门口，一直有一个身影佝偻摊位面前，日复一日的劳作老人年事已高，却依然坚守在这里成为一代又一代老重庆人的精神地标。这个摊位并不支持电子支付方式，所以请去的同学自备零钱。</p><p>卖的是糯米团，一层油条干+一层糯米+一层砂糖+一层豆面，配上一杯新鲜的现磨豆浆，8块钱，一个早上都让你饱饱的。糯米团是老人提前一天晚上蒸好的，豆浆是早上现磨的，老人很忙，经常会出现供不应求的情况，早上7点到下午14点，中午12点之后限购。真的非常的实诚，以至于早上8点半到达都排队等待了一个多小时才吃到。 <strong>一个城市的灵魂，或许正是在这些街边小摊和市井民众上体现出来的那一种精神吧。</strong></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-1.jpg" alt="CSMNMT1"></p><p>略显佝偻的身影</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-2.jpg" alt="CSMNMT2"></p><p>实在的糯米团外表</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-3.jpg" alt="CSMNMT3"></p><p>糯米团内在</p><p>拿到糯米团已经是早上十点多，便急忙赶往了磁器口古镇。</p><h3 id="磁器口"><a href="#磁器口" class="headerlink" title="磁器口"></a>磁器口</h3><p>磁器口古镇原名瓷器口镇、白崖镇、白岩场镇，因明帝朱允炆退位后隐居于此，也叫龙隐镇，位于重庆市沙坪坝区，比邻嘉陵江，有“小重庆”之称。自明、清时期以来磁器口一直是重要的水陆码头，为嘉陵江下游物资集散地。现在的磁器口已经是和丽江完全一样的商业化购物街了，没有什么意思，随处飘荡着劣质火锅底料的味道。这里著名的特色小吃有陈麻花、古镇鸡杂、毛血旺等。向来不太喜欢喧嚣闹市的我便选择了一条小径拾级而上。</p><p>磁器口入口与陈麻花</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-4.jpg" alt="CQKRK"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-5.jpg" alt="CQKCMH"></p><p>磁器口的歇脚小栈和一只悠然自得的流浪猫</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-6.jpg" alt="CQKLittleShop"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-7.jpg" alt="CQKCat"></p><p>磁器口的人来人往与变脸艺术</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-8.jpg" alt="CQKPeople"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-9.jpg" alt="CQKBIL"></p><h3 id="重庆记忆"><a href="#重庆记忆" class="headerlink" title="重庆记忆"></a>重庆记忆</h3><p>沿小径而上之后来到了一座博物馆，名字叫做重庆记忆。这里保存了过去几十年的粗瓷精品和脸谱艺术杰作，更有与现代艺术结合的工艺品。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-10.jpg" alt="CQJY1"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-11.jpg" alt="CQJY2"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-12.jpg" alt="CQJY3"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-13.jpg" alt="CQJY4"></p><h2 id="Day-2-下午"><a href="#Day-2-下午" class="headerlink" title="Day 2 - 下午"></a>Day 2 - 下午</h2><h3 id="离奇的被动逃票经历-——-南山一棵树"><a href="#离奇的被动逃票经历-——-南山一棵树" class="headerlink" title="离奇的被动逃票经历 —— 南山一棵树"></a>离奇的被动逃票经历 —— 南山一棵树</h3><p>离开重庆记忆之后，实在没找到合适的吃午饭的地方，便只好选择 M 记 <del>作为我家食堂</del>。那天正值周末，又是雾都难得的晴天，便有很多人前往南山。（PS. 土豆君在这里建议有条件的朋友晚上前往，重庆夜间全景更加美丽。因为时间不够，我只能白天去了…）到了上山的半路便堵车了…心急如焚却又想按照约定时间到达的土豆只好选择下车步行，恰好碰上了两个本地人。便决定徒步爬山，抄“近道”尽快到达…(结果走了远道还绕到深山老林中…)</p><p>庆幸小时候经常爬山，爬上的本领在这里派上了用场，一路奋斗之后却不小心来到了接近山顶的位置。而南山一棵树却在山的半山腰…气喘吁吁、先上后下走了接近40分钟之后终于发现了常规人类建筑XD ，意外之中发现已经进入了景区，就这样莫名奇妙爬了个山、逃了个票…</p><p>雾气蒙蒙的南山深处</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-14.jpg" alt="NSYKSInMountain"></p><h3 id="长江索道"><a href="#长江索道" class="headerlink" title="长江索道"></a>长江索道</h3><p>不废话，直接上图，“行千里 致广大”</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-15.jpg" alt="CJSD1"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-16.jpg" alt="CJSD2"></p><h3 id="晚饭-——-秀孃串串香"><a href="#晚饭-——-秀孃串串香" class="headerlink" title="晚饭 —— 秀孃串串香"></a>晚饭 —— 秀孃串串香</h3><p>深藏于小巷的居民楼深处，又是一座名声大噪的街边小店、到达时接近下午5点，却已需要等位… 还是上面的那句老话： <strong>一个城市的灵魂，或许正是在这些街边小摊和市井民众上体现出来的那一种精神吧。</strong></p><p>(PPS. 重庆的妹子真的很漂亮哎~)</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-17.jpg" alt="XNCCX"></p><h2 id="Day-2-夜"><a href="#Day-2-夜" class="headerlink" title="Day 2 - 夜"></a>Day 2 - 夜</h2><p>来重庆，没有看过重庆的夜景，就是白来了。夜晚，朝天门码头，两江交汇。未来，希望还有机会和那个 ta 再来一次。</p><hr><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-27.jpg" alt="2019cq-d2-27.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-24.jpg" alt="2019cq-d2-24.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-18.jpg" alt="2019cq-d2-18.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-26.jpg" alt="2019cq-d2-26.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-22.jpg" alt="2019cq-d2-22.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-19.jpg" alt="2019cq-d2-19.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-21.jpg" alt="2019cq-d2-21.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-25.jpg" alt="2019cq-d2-25.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-28.jpg" alt="2019cq-d2-28.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-30.jpg" alt="2019cq-d2-30.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-20.jpg" alt="2019cq-d2-20.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-29.jpg" alt="2019cq-d2-29.jpg"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-23.jpg" alt="2019cq-d2-23.jpg"></p><hr><p>船内一景</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day2/2019cq-d2-31.jpg" alt="InsideShip"></p><p>The END</p><p>Rev.1 2019.2.23~2.24 于 学校宿舍</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Personal" scheme="https://www.kmahyyg.xyz/tags/Personal/"/>
    
  </entry>
  
  <entry>
    <title>2019 新年之旅 - 重庆 Day 1</title>
    <link href="https://www.kmahyyg.xyz/2019/cqcd-trip-cqday1/"/>
    <id>https://www.kmahyyg.xyz/2019/cqcd-trip-cqday1/</id>
    <published>2019-02-24T00:06:21.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="重庆"><a href="#重庆" class="headerlink" title="重庆"></a>重庆</h1><h2 id="逛吃逛吃-重庆-Day-1"><a href="#逛吃逛吃-重庆-Day-1" class="headerlink" title="逛吃逛吃 - 重庆 - Day 1"></a>逛吃逛吃 - 重庆 - Day 1</h2><h3 id="糟糕的交通"><a href="#糟糕的交通" class="headerlink" title="糟糕的交通"></a>糟糕的交通</h3><p>这一次的旅行安排的实际非常仓促，因为学习、春运临近的多重压力，并没有太过仔细的看别人之前写过的攻略。导致了很多本可以避免的失误，下次还是做清楚计划再继续吧。 <del> 其实是多带了一位亲人，做详细计划什么的，不存在的（划掉划掉）</del> 原定三天的行程，由于交通原因，实际只剩下两天半。</p><p>第一天早早到达了机场，飞机起飞延误了半个小时，最终导致了整体延误了大约 20 分钟。一到山城，便被这”山”来了个”下楼威”，建议来这里的朋友都尽可能减少行李的体积。地铁站和任何一个你可能会去的知名建筑物总是相隔 700 ～ 800 米的距离，正所谓坐公交什么的都是没意思的。你或许会说有共享单车，很抱歉，由于重庆多山的地势，加之临近江边空气潮湿、道路日常湿滑，基本上你与共享单车是绝缘的。支付宝支持的几家自行车中只有 OFO 有覆盖，然而业已接近破产的 OFO，实际上根本找不到可用车辆。地铁的站内换乘，更多的可以视为跨站换乘，同一站的两条线，乘车站台总是天上和地下，每次都能让你爬得气喘吁吁。安检强制检查液体，也复杂了一些手续，加之整体公共交通接驳不好，走路便成为了日常。这里还请未来需要前往的朋友注意。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day1/2019cq-1.jpg" alt="Running with the underground"></p><h3 id="AirBNB-in-China"><a href="#AirBNB-in-China" class="headerlink" title="AirBNB in China"></a>AirBNB in China</h3><p>第一天到达住处之后最让我惊讶的就是这次的住所，这次的住所在 AirBNB （然而只有 Bed 并没有 And Breakfest）预定，房东小姐姐非常的热情，人也非常美丽，提前为我们准备了城市一卡通，免去了一些忧虑。房子的布局类似单身公寓，装修非常的有逼格，面对阳台就是江景，你大可晚上买上一些串串在窗边边吃边赏。重庆一卡通可以在任意一个地铁站充值，个人推荐使用，最有用的地方是长江索道，这个我们后面再提，支付宝的乘车码在这里的所有公交是通用的，遗憾的是不含地铁，所以并没有什么卵用。地铁覆盖率非常高，重庆的地面交通规划十分糟糕，单行道+晴天堵车+下雨堵车+平均20点的公交末班，让人毫无出行的心意。出租车起步价 10 元，额外加价 2.3 元/公里，也算是有点诚意吧。当地的交通状况和路况就决定了公交和出租司机都具有 F1 赛车的潜质，请大家务必小心。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day1/2019cq-2.jpg" alt="AirBNB House"></p><h2 id="Day-1-中午"><a href="#Day-1-中午" class="headerlink" title="Day 1 - 中午"></a>Day 1 - 中午</h2><p>折腾了大半晌之后到达重庆便已经是中午一点多了，肚子早已饿得不行，来到住所放完了行李，便直奔着重庆最大的美食城——八一好吃街而去：</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day1/2019cq-3.jpg" alt="81HCJ"></p><p>来重庆，自然要品尝的第一件事情就是最地道的酸辣粉。整个重庆最为有名的就是这家好又来：</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day1/2019cq-4.jpg" alt="HYLSLF"></p><p>整体来看和本地的酸辣粉相比差别不大，不过感觉更加的辣，米粉偏干，不太适合云南人的口味。</p><p>吃完了辣的， <del>为了弥补味觉的创伤</del> ，便考虑前往寻找一些平和温凉的食物。挑来挑去，苦于没有一个详细的计划，七拐八绕之后，在日月光广场的 -1F 找到了这个地方： 山城老冰粉。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day1/2019cq-5.jpg" alt="LBFSW"></p><p>淡淡的桂花糖，温暖的芝麻香和一些坚果，凉凉的糍粑粉，让人有一种独特的惊艳感。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day1/2019cq-6.jpg" alt="LBFDM"></p><p>这家店店面隐藏在商场的一个角落之中，很是难找，毕竟“好事多磨”，希望下次去的时候可以再次体验吧。<br>店家老板曾经在云南学习，十分怀念云南的鲜花、阳光和新鲜的芥菜，在他乡听到这样的一种谈论，也是有些暖暖的欣慰。</p><h2 id="Day-1-下午"><a href="#Day-1-下午" class="headerlink" title="Day 1 - 下午"></a>Day 1 - 下午</h2><p>吃完了冰粉，已经接近下午四点。看了看地图，发现在这该死的山城里 GPS 总是失灵，由于接下来时间安排的限制，只能去走走最近的一些景点了。地图上最近一个 POI 就是新华日报社旧址，旧址现已被翻修一新，内部展览着过去出版的新华日报和报社工作人员的生活环境还有一些当时新华日报的成就。下面两张图是我觉得记忆很深的一部分：（门口的标语我只拍了一半，不知道当时创立新华日报的编辑看到现在的新华日报和这两幅标语，心中会是何种滋味）</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day1/2019cq-7.jpg" alt="OldChinaDaily1"></p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day1/2019cq-8.jpg" alt="OldChinaDaily2"></p><p>约莫逛了一个多小时，就又到了饭点，便来到了重庆的解放碑商圈。这座纪念碑，象征了新中国成立之前那几辈人的艰辛，是民国人的“精神堡垒”。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day1/2019cq-9.jpg" alt="RevolutionMemorial"></p><h2 id="Day-1-晚上"><a href="#Day-1-晚上" class="headerlink" title="Day 1 - 晚上"></a>Day 1 - 晚上</h2><p>晚上，提前和大哥约了晚饭，<a href="https://map.baidu.com/?shareurl=1&amp;poiShareUid=5a993447ac44d6b2b8bd633d" target="_blank" rel="noopener">POI 锅锅筵水八块重庆老火锅</a>。味道很正，没有让重庆人做出“最大的让步” （XD 好像我还是能吃辣的），原本说吃完饭还有时间就去洪崖洞逛逛，结果边吃边聊，吃完就接近 22 点了，直接回了住处，一天就这样结束了。</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/cq-day1/2019cq-10.jpg" alt="GGYHotPot"></p><p>店门口夜间漫步一景，略微下着些小雨，对岸的那个建筑就是重庆大剧院。</p><p>THE END</p><h2 id="DEPRECATED"><a href="#DEPRECATED" class="headerlink" title="DEPRECATED"></a>DEPRECATED</h2><p>由于时间安排不当，当天的行程被 DEPRECATED 了下列 POI：</p><ul><li>洪崖洞</li><li>南山一棵树</li></ul><p>Rev.1 2019.1.20 于 G8710 次列车<br>Rev.2 2019.1.24 于 家中<br>Rev.3 2019.2.23 于 学校宿舍 终稿</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Personal" scheme="https://www.kmahyyg.xyz/tags/Personal/"/>
    
  </entry>
  
  <entry>
    <title>2019 新年之旅 - 前言也是结尾</title>
    <link href="https://www.kmahyyg.xyz/2019/cqcd-trip/"/>
    <id>https://www.kmahyyg.xyz/2019/cqcd-trip/</id>
    <published>2019-02-22T21:06:04.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><iframe src="https://open.spotify.com/embed/track/7AofxV7mKRmUf8AT0lclMy" width="300" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media" autoplay="true"></iframe><h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><blockquote><p>夫景以情合，憎以景生，初不相离，唯意所适，截分两杨，则情不足兴，而景非其景。</p></blockquote><p>2019 年到来的是如此的快，不知不觉间大学已经来到了第二学年的中间。经过了大二上半期各个方面的磨难，终究是苦尽甘来。等待成绩出炉的日子是那么的忐忑，还好最终的结果并不让人那么失望。18 号早晨，起得很早，来到了重庆，开始了这一年的旅行。</p><h2 id="见到大哥这个意外的惊喜"><a href="#见到大哥这个意外的惊喜" class="headerlink" title="见到大哥这个意外的惊喜"></a>见到大哥这个意外的惊喜</h2><p>一直以一种程序猿固有的印象在猜测大哥应该会是一个五大三粗的程序猿吧，实际见到之后发现是一个开朗的大帅哥。奇妙般的相识带来了这次数年之后的奇遇，感谢缘分吧。非常开心快乐的一次旅行。</p><h2 id="莫名其妙的想到了自己的感情"><a href="#莫名其妙的想到了自己的感情" class="headerlink" title="莫名其妙的想到了自己的感情"></a>莫名其妙的想到了自己的感情</h2><blockquote><p>All that really matters is don’t stop trying.</p></blockquote><p>期间不经意的想到最近一些事情，心里总是有一些莫名的担心，谁知道下一个学期会发生什么呢。和大哥一起吃完饭的那天也晚上微醺之后回到住处，忽然也提到了一些相关的东西。大哥提醒了我，到底我和我的 Mate 想要的过程还是结果，这是一个需要认真思考的问题。”越担心失去，越容易失去”，真的是一语成谶。人，本就是一个矛盾与统一的结合体。还是想明白上面的问题之后就不要想太多的东西了吧，毕竟选择已经做下，唯一剩下就是全身心的投入。再放下一点点吧，真的那么爱她。剩下的，或许，时间会告诉我答案吧。</p><h2 id="把感受放到这里"><a href="#把感受放到这里" class="headerlink" title="把感受放到这里"></a>把感受放到这里</h2><p>咕咕咕了很久之后，这几篇游记博客终于开始动工了。最近总是在心里想一个人，想来想去，别人都不把你放在心上，那也没必要太过折腾了。最近在忙着考驾照，从周围的朋友那里听了不少故事，让人觉得还是独自一人的宇宙更加广大。</p><p>之前答应了一个人，这个假期和 ta 一起去游历祖国的大好河山，我原本打算现在就开始做下各种积累和准备，现在看起来也没必要了。回来之后遇到了一个小姐姐，有些事情也不太方便在这里写出，只能感叹一句，陌生人有时候比你想象中温暖的太多太多。接下来，我会更加的向事业方向发展，考虑斩断一些完全没有必要的社交链，还是浪费了太多心去维护一段感情了。</p><p>某天在 <a href="https://kirikira.moe/post/34/" target="_blank" rel="noopener">kiri 大佬的博客</a> 看到了 ta 的年末感想，有这样几段，特摘录在此，不做太多的评论和解释了：</p><blockquote><p>九月底的时候，我突然觉得反正已经孤单一人了，不如干点没有一个人干过的事吧！于是直接订下了去长沙和重庆的国庆机票/车票，联系上在这两个地方的同学做免费导游，开始了第一次的一人旅游。在长沙招待我的是曾经一段不成功的恋情的对象和中学时代最好的朋友。与她重逢时，庆幸的是面对面的气氛并没有那么尴尬，尽管已经有一年多没见，还是能找到一些话题扯东扯西，从过去扯到现在，从其他人扯到自己；但不幸的是，她还是我喜欢的那个她，曾经让我着迷的她的可爱之处一点没变，在稚气的底下还多了几分成熟，一想到我们已经不可能重来了这件事就让我有些许伤感。</p></blockquote><blockquote><p>在这样的念头起来的时候，我确信了几件事情。对我这种人来说，行动总比空坐着纠结犹豫要好，一旦开始纠结的话，不如马上按照第一感觉行动起来，不给大脑迟疑的机会；我也不是会后悔的人，不论现在的处境如何，都是自己过去的一个一个选择累计起来得到的结果，如果当时的选择在那个时刻看来是合情合理的，那么即使再给我一次机会消除记忆回到过去，我也肯定是会做出同样的选择来，既然如此就没什么好后悔的了。</p></blockquote><blockquote><p><strong>“不是两个人就不好，而是我一个人就很好。”这句话从以前开始我就经常念叨，但在最近一两年我才确信了这件事。两个人是很美好，但是要找到另一个志同道合、两厢情愿的异性也是一件非常难的事。与其每天被发情所苦，或陷入不可能的单恋中浪费人生，再以自己感动自己收尾，不如发现一个人的好处。一个人可以省下一次约会一顿饭就三位数的钱，可以不用上班打卡一样的定期见面和晚安，可以来一场毫无规划的到处乱走的旅行，可以当一回傻逼，在跨年的夜里走到人山人海的江滩，等着不存在的烟花。</strong></p></blockquote><h2 id="下一次旅行"><a href="#下一次旅行" class="headerlink" title="下一次旅行"></a>下一次旅行</h2><p><img src="https://alicdn.kmahyyg.xyz/asset_files/cqcd2019/2019cqcd-preface.jpg" alt="LOVE TO YU"></p><p>本来是和我心里那个人一起去游山玩水，现在看起来只能呵呵。下一个目的地，或许是某个现代化大都市，亦或许是某个寂静的小镇吧。这次除了重庆的前两天的行程之外，过得很不愉快，我讨厌那种喧嚣吵闹的所谓“旅游热点”，只想一个人在人烟稀少的地方，观察生活和自然的那份纯净空灵的美好。再也不会去所谓的旅游热点了…</p><p>The END</p><p>Rev.1 2019.1.20 于 G8710 次列车<br>Rev.2 2019.1.24 于 家中<br>Rev.3&amp;4&amp;5 2019.2.22 于 学校宿舍 终稿</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Personal" scheme="https://www.kmahyyg.xyz/tags/Personal/"/>
    
  </entry>
  
  <entry>
    <title>2018 汇编大作业</title>
    <link href="https://www.kmahyyg.xyz/2019/ASM-BigHomework/"/>
    <id>https://www.kmahyyg.xyz/2019/ASM-BigHomework/</id>
    <published>2019-02-08T09:24:00.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="整体思路"><a href="#整体思路" class="headerlink" title="整体思路"></a>整体思路</h2><p><img src="https://alicdn.kmahyyg.xyz/asset_files/2019-asmbighw-flow.webp" alt="workflow chart"></p><p>Storage:</p><ul><li>Test</li></ul><p>Encrypt:</p><ul><li>Test</li></ul><p>Decrypt:</p><ul><li>Test</li></ul><p>MBR PlaceHolder:</p><h2 id="Source-code"><a href="#Source-code" class="headerlink" title="Source code"></a>Source code</h2><p>Check <a href="https://github.com/kmahyyg/MBRLock" target="_blank" rel="noopener">Github Repository</a> , Please.</p><p>All source codes are well-commented. If you have any questions, please open a Issue in GitHub.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>观察发现 MS-DOS 7.11 和 WinXP 的 磁盘，1～31 扇区均为空！（0 扇区为 MBR）</p><ul><li><a href="https://stackoverflow.com/questions/21463908/x86-instructions-to-power-off-computer-in-real-mode" target="_blank" rel="noopener">https://stackoverflow.com/questions/21463908/x86-instructions-to-power-off-computer-in-real-mode</a></li><li><a href="https://wiki.osdev.org/APM" target="_blank" rel="noopener">https://wiki.osdev.org/APM</a></li><li><a href="https://stackoverflow.com/questions/1396909/ret-retn-retf-how-to-use-them" target="_blank" rel="noopener">https://stackoverflow.com/questions/1396909/ret-retn-retf-how-to-use-them</a></li><li><a href="https://stackoverflow.com/questions/39474332/assembly-difference-between-var-and-var/39474660" target="_blank" rel="noopener">https://stackoverflow.com/questions/39474332/assembly-difference-between-var-and-var/39474660</a></li><li><a href="https://sourcegraph.com/github.com/sunnyden/MBRLock@master/" target="_blank" rel="noopener">https://sourcegraph.com/github.com/sunnyden/MBRLock@master/</a></li><li><a href="https://www.felixcloutier.com/x86/" target="_blank" rel="noopener">https://www.felixcloutier.com/x86/</a></li><li><a href="https://asminst.kmahyyg.xyz/" target="_blank" rel="noopener">https://asminst.kmahyyg.xyz/</a></li><li><a href="https://blog.csdn.net/u013630349/article/details/50370227" target="_blank" rel="noopener">https://blog.csdn.net/u013630349/article/details/50370227</a></li><li><a href="https://docs.microsoft.com/en-us/cpp/cpp/argument-passing-and-naming-conventions?view=vs-2017" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/cpp/cpp/argument-passing-and-naming-conventions?view=vs-2017</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Tech" scheme="https://www.kmahyyg.xyz/tags/Tech/"/>
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>YNU - 汇编语言程序设计实验报告 4-5</title>
    <link href="https://www.kmahyyg.xyz/2019/ASM-exp-report2/"/>
    <id>https://www.kmahyyg.xyz/2019/ASM-exp-report2/</id>
    <published>2019-01-11T20:58:01.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p>如未署名，所有 *.kmahyyg.xyz 的域名下的版权均为本人所有，遵循对应站点下的授权协议。</p><p>本篇文章授权 采用 CC BY-NC-ND 3.0 Unported 协议，禁止转载。</p><h1 id="Experiment-4"><a href="#Experiment-4" class="headerlink" title="Experiment 4"></a>Experiment 4</h1><h2 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h2><p>使用虚拟机 Qemu-KVM 和调试器 Bochs，执行，调试 MBR 扇区代码，了解计算机启动的原理和 MBR 扇区代码的功能。</p><h2 id="实验内容"><a href="#实验内容" class="headerlink" title="实验内容"></a>实验内容</h2><ol><li>阅读参考源程序并增加注释；</li><li>在参考源程序中增加指令(不要改变原程序的功能)，为程序增加功能：输出你的学号和姓名拼音；</li></ol><p>SRC:     <a href="https://gist.github.com/kmahyyg/ce0d0e3079363f7be5d91f7ace0d9c0d" target="_blank" rel="noopener">https://gist.github.com/kmahyyg/ce0d0e3079363f7be5d91f7ace0d9c0d</a></p><ol start="3"><li>使用 NASM 工具将修改后的实验源程序编译为 .bin 文件；</li><li>将 .bin 文件用 dd 写入虚拟机硬盘 MBR 扇区；</li><li>使用 Qemu-KVM 虚拟机观察写入 .bin 文件的执行结果；</li></ol><p>Tutorial:    <a href="https://blog.kmahyyg.xyz/2018/ASM-exp-report/#%E5%AE%9E%E9%AA%8C%E6%93%8D%E4%BD%9C%EF%BC%9A%E7%BC%96%E8%AF%91%E5%AE%8C%E6%88%90%E5%90%8E%E7%9A%84-BOCHS-%E5%AF%BC%E5%85%A5" target="_blank" rel="noopener">https://blog.kmahyyg.xyz/2018/ASM-exp-report/#%E5%AE%9E%E9%AA%8C%E6%93%8D%E4%BD%9C%EF%BC%9A%E7%BC%96%E8%AF%91%E5%AE%8C%E6%88%90%E5%90%8E%E7%9A%84-BOCHS-%E5%AF%BC%E5%85%A5</a></p><ol start="6"><li>关闭 Qemu-KVM，使用 BochsDBG 虚拟机调试写入在虚拟硬盘 MBR 扇区中的程序；</li></ol><p><img src="https://alicdn.kmahyyg.xyz/asset_files/2018-asmexp3-02.webp" alt="2018-asmexp3-02.png"></p><h2 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h2><ol><li>计算机如何在屏幕上显示字符？</li></ol><p><a href="https://asm.kmahyyg.xyz/exps/exp7-transfer.html#quiz-2%EF%BC%9A-%E6%A0%B9%E6%8D%AE%E6%9D%90%E6%96%99%E7%BC%96%E7%A8%8B" target="_blank" rel="noopener">https://asm.kmahyyg.xyz/exps/exp7-transfer.html#quiz-2%EF%BC%9A-%E6%A0%B9%E6%8D%AE%E6%9D%90%E6%96%99%E7%BC%96%E7%A8%8B</a></p><ol start="2"><li>如何输入输出 10 进制数据？如何输入数字、字符串？</li></ol><p><a href="https://computer.howstuffworks.com/bios1.htm" target="_blank" rel="noopener">https://computer.howstuffworks.com/bios1.htm</a></p><p><a href="https://blog.csdn.net/qq_28598203/article/details/51081368" target="_blank" rel="noopener">https://blog.csdn.net/qq_28598203/article/details/51081368</a></p><p>结合中断向量表实现。</p><ol start="3"><li>MBR 扇区有什么特点？MBR 扇区中的代码实现什么功能？</li></ol><p><a href="https://wiki.osdev.org/MBR_(x86)" target="_blank" rel="noopener">https://wiki.osdev.org/MBR_(x86)</a></p><ol start="4"><li>简述计算机复位后的启动过程。</li></ol><p><a href="https://wiki.osdev.org/Boot_Sequence" target="_blank" rel="noopener">https://wiki.osdev.org/Boot_Sequence</a></p><h1 id="Experiment-5"><a href="#Experiment-5" class="headerlink" title="Experiment 5"></a>Experiment 5</h1><h2 id="实验目的-1"><a href="#实验目的-1" class="headerlink" title="实验目的"></a>实验目的</h2><p>了解计算机屏幕显示的原理，编程实现显存映射与中断 <code>int 10H</code> 式。</p><h2 id="实验内容-1"><a href="#实验内容-1" class="headerlink" title="实验内容"></a>实验内容</h2><ol><li>使用控制显存显示内容。</li></ol><blockquote><p>略，之前的实现均使用的这种方式。MASM 与 NASM 的差异，在使用这种方式时差异不大，此处略去不表。</p></blockquote><ol start="2"><li>使用 <code>int 10H</code> 方式显示数据。</li></ol><p>看这里！这里有代码： </p><p>MASM: <a href="https://gist.github.com/kmahyyg/4e8dc523f513ff78a53c18e4234460af" target="_blank" rel="noopener">https://gist.github.com/kmahyyg/4e8dc523f513ff78a53c18e4234460af</a></p><p>NASM: <a href="https://gist.github.com/kmahyyg/4e8dc523f513ff78a53c18e4234460af" target="_blank" rel="noopener">https://gist.github.com/kmahyyg/4e8dc523f513ff78a53c18e4234460af</a></p><h2 id="思考题-1"><a href="#思考题-1" class="headerlink" title="思考题"></a>思考题</h2><ol><li>注释源程序</li></ol><p>已经注释了，懒得多写废话，具体的详细文档自己看后面的 Reference。这里略微一提， BIOS 是一个最小型的系统，在硬件支持 int 13h 对应的显示模式的前提下，可以通过 BIOS 中断向量 int 10h 调用显示 API。</p><p>具体参考这里 <a href="https://protas.pypt.lt/informatika/assembler/writing_to_the_screen" target="_blank" rel="noopener">https://protas.pypt.lt/informatika/assembler/writing_to_the_screen</a></p><p>2.显示字符的方式</p><p>就两种，实验目的里写的很清楚，具体的自己去查资料。</p><h1 id="Experiment-6"><a href="#Experiment-6" class="headerlink" title="Experiment 6"></a>Experiment 6</h1><h2 id="实验目的-2"><a href="#实验目的-2" class="headerlink" title="实验目的"></a>实验目的</h2><p>接受键盘输入，保存到磁盘；从磁盘读取，显示到屏幕。</p><h2 id="实验实现"><a href="#实验实现" class="headerlink" title="实验实现"></a>实验实现</h2><p>目前问题：</p><p>Can： 接受输入、保存到 FDD，从磁盘读取，读取到指定的具体的固定 RAM 地址并显示。</p><p><del>Cannot： 读取到变量对应的地址并显示，读取 FDD 成功但写入 RAM 失败… 已修复： dx 和 bx 两个寄存器中传入的地址存在问题</del></p><p>接受输入，写入 FDD 的代码：</p><pre class="line-numbers language-asm6502"><code class="language-asm6502">dataarea segment    buffer db 64   ; max 63 bytes string           db ?    string db 64 dup ('$')  ; preallocated with '$', int 21h/0ah outputdataarea endscodesg segment;START PROCmain proc far    assume cs:codesg,ds:dataareastart:;SAVE THE CURRENT SITUATION FOR RET    push ds    sub ax,ax    push ax;POINT CORRESPONDING DATA REGISTER    mov ax,dataarea    mov ds,ax;GET INPUT FROM KEYBOARD    lea dx,buffer    mov ah,0ah    int 21h;PREPARE ES:BX to where data to be wrote into    mov ax,dataarea    mov es,ax    lea bx,string;WRITE DATA TO FDD, 0 Cylinder: 0 Track: 4 Sector;Each sector has 512 bytes    mov ah,3  ; 3 for write    mov al,1  ; how many sectors to write    mov dh,0  ; cylinder    mov ch,0  ; track    mov cl,4  ; sector    mov dl,0  ; drive no.     ;0:FDD-A, 1:FDD-B, 80H:HDD-C, 81H:HDD-D    int 13h     retmain endpcodesg ends    end start <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从 FDD 中读取内容并显示在屏幕上：</p><pre class="line-numbers language-asm6502"><code class="language-asm6502">datasg segment    readout db 512 dup ('$')datasg endscodesg segmentstart:        mov ax,datasg        mov ds,ax        mov es,ax        lea bx,readout   ;ready for read buffer        mov ah,2        mov al,1        mov dh,0        mov ch,0        mov cl,4        mov dl,0        int 13h        mov dx,offset readout        mov ah,9        int 21h        mov ax,4c00h        int 21hcodesg endsend start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>接受输入之后回显打印：</p><pre class="line-numbers language-asm6502"><code class="language-asm6502">;sudo mount -o loop,offset=$(python -c 'print(512*63)') /var/lib/libvirt/images/dosdata.img /mnt/nfs1dataarea segment    buffer db 64           db ?    string db 64 dup ('$')    hint   db 10,13,'$'dataarea endscodesg segmentmain proc far    assume cs:codesg,ds:dataareastart:    push ds    sub ax,ax    push ax    mov ax,dataarea    mov ds,ax    lea dx,buffer    mov ah,0ah    int 21h    mov cx,2newl:    lea dx,hint    mov ah,9h    int 21h    loop newl    lea dx,string    mov ah,9h    int 21h    retmain endpcodesg ends    end start <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>不要忘记打末尾的 <code>h</code></strong></p><pre><code>INT 13h / AH = 02h - read disk sectors into memory.INT 13h / AH = 03h - write disk sectors.    input:AL = number of sectors to read/write (must be nonzero)CH = cylinder number (0..79).CL = sector number (1..18).DH = head number (0..1).DL = drive number (0..3 , for the emulator it depends on quantity of FLOPPY_ files).ES:BX points to data buffer.    return:CF set on error.CF clear if successful.AH = status (0 - if successful).AL = number of sectors transferred. Note: each sector has 512 bytes.</code></pre><pre><code>INT 21h / AH=9 - output of a string at DS:DX. String must be terminated by &#39;$&#39;. example:        org 100h        mov dx, offset msg        mov ah, 9        int 21h        ret        msg db &quot;hello world $&quot;</code></pre><pre><code>INT 21h / AH=0Ah - input of a string to DS:DX, fist byte is buffer size, second byte is number of chars actually read. this function does not add &#39;$&#39; in the end of string. to print using INT 21h / AH=9 you must set dollar character at the end of it and start printing from address DS:DX + 2. </code></pre><h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1><p>本学期的汇编课程所有的的随堂实验就到此告一段落，感谢 王逍 老师的精心付出。<br>和 钰 在各方面的帮助，爱你！</p><p>Updated on 2019-01-11 20:58:01<br>Rev. 11</p><h1 id="Reference-1"><a href="#Reference-1" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://thestarman.pcministry.com/asm/mbr/STDMBR.htm" target="_blank" rel="noopener">https://thestarman.pcministry.com/asm/mbr/STDMBR.htm</a></p><p><a href="https://thestarman.pcministry.com/asm/bios/index.html" target="_blank" rel="noopener">https://thestarman.pcministry.com/asm/bios/index.html</a></p><p><a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-823-computer-system-architecture-fall-2005/index.htm" target="_blank" rel="noopener">https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-823-computer-system-architecture-fall-2005/index.htm</a></p><p><a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-828-operating-system-engineering-fall-2012/index.htm" target="_blank" rel="noopener">https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-828-operating-system-engineering-fall-2012/index.htm</a></p><p><a href="https://stackoverflow.com/questions/41196376/int-10h-13h-bios-string-output-not-working" target="_blank" rel="noopener">https://stackoverflow.com/questions/41196376/int-10h-13h-bios-string-output-not-working</a></p><p><a href="http://www.ablmcc.edu.hk/~scy/CIT/8086_bios_and_dos_interrupts.htm" target="_blank" rel="noopener">http://www.ablmcc.edu.hk/~scy/CIT/8086_bios_and_dos_interrupts.htm</a></p><p><a href="https://wiki.osdev.org/ATA_PIO_Mode" target="_blank" rel="noopener">https://wiki.osdev.org/ATA_PIO_Mode</a></p><p><a href="https://stackoverflow.com/questions/8461363/access-harddrive-using-assembly" target="_blank" rel="noopener">https://stackoverflow.com/questions/8461363/access-harddrive-using-assembly</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Tech" scheme="https://www.kmahyyg.xyz/tags/Tech/"/>
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
  <entry>
    <title>2018 学年度第二学期既年终总结</title>
    <link href="https://www.kmahyyg.xyz/2019/2018-EndofYear/"/>
    <id>https://www.kmahyyg.xyz/2019/2018-EndofYear/</id>
    <published>2019-01-11T11:55:00.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>BGM: 范玮琪 - 蒲公英 (Offered by Spotify)</p><iframe src="https://open.spotify.com/embed/track/2xLr6lYJV01kfzVpeFYM5a" width="300" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe><h1 id="2018-年的年终"><a href="#2018-年的年终" class="headerlink" title="2018 年的年终"></a>2018 年的年终</h1><p>一年又在眨眼间悄然逝去，这一年中经历的起伏跌宕，让人难以琢磨，伤心欲绝却又欢天喜地。 2019 年的 1 月 1 日的钟声早已响过，2012 所谓的 “世界末日” 也已经过去了六个年头。</p><h2 id="年终盘点"><a href="#年终盘点" class="headerlink" title="年终盘点"></a>年终盘点</h2><p><del>支付宝和微信、各种银行卡账单什么的就算了。依旧剁手买了很多东西XD，包括 iPad 乞丐版什么的。另外嘛，就是我这个以前从来不知道买东西给姑娘的，现在也会送礼物了。真的很喜欢ta呢。</del><br>这一年可以说是挫折很多，忙到根本没有办法顾及自己休息的一年。<br>在过去的一年里：</p><ul><li>我考了驾照的科目一，却因为学业繁忙没有完成后面的考试。</li><li>Github 上，积极参与了开源项目，将我的绝大部分代码托管到了 Github。</li></ul><p>根据 Github Profile 页的 Contribution 显示，过去的一年中，我完成了 1126 Contribution，其中最忙的单日完成了 34 个 Contribution，平均每天 3.08 次，最长的一次连击发生在 12.10～12.25。</p><ul><li>学业上算是小有成就，勉强算是刚刚踩在达成目标的及格线上吧。</li></ul><p>简略的来说，就这些。</p><h2 id="2018-年的最后一个学期-学习与朋友"><a href="#2018-年的最后一个学期-学习与朋友" class="headerlink" title="2018 年的最后一个学期 @学习与朋友"></a>2018 年的最后一个学期 @学习与朋友</h2><p>这一年中的最后一个学习非常的繁忙，基本上一直维持着连轴转的程度，平均每两个月给自己放一次假也是非常的爆炸，大部分的时间都花在了逍爷的课程上，也算是学有所得。一些令人无奈的数学也是让人烦恼，<br>主要的问题就是找出一个侧重点、安排好自己的时间，不然压根没时间复习其他科目，平常的各科也要齐头并进才好啊。毕竟期末抱佛脚不是长久之技。</p><p>新的一年了，总之还是要把各种薄弱项加强过、理解过才行。</p><p>一个朋友，今年因为异地高考问题，被迫退学，在异乡漂泊了半年多，现在也回来了，不知道他现在怎么样了。</p><h2 id="2018-年跨年的“惊吓”-技术"><a href="#2018-年跨年的“惊吓”-技术" class="headerlink" title="2018 年跨年的“惊吓” @技术"></a>2018 年跨年的“惊吓” @技术</h2><p>在 2018 年的最后几个小时里，学长在陪我高数跨年，一把辛酸泪。好消息是，迎来了逍爷的“惊吓”，一直在等，还算是等来了。</p><h2 id="2019-年的旅行"><a href="#2019-年的旅行" class="headerlink" title="2019 年的旅行"></a>2019 年的旅行</h2><p>开年之初，便是寒假的到来，今年的寒假让人觉得格外的难受，又冷又短，提心吊胆。早早就安排了旅行，重庆和成都。</p><p>顺道去看看哥们，体验一下重庆美的让人窒息的夜景，感受下带不走的成都。</p><p>唯一令人伤心的就是亲爱的钰并不能与我同行。（具体的安排还没做，XD）</p><h2 id="2018-2019-的情感"><a href="#2018-2019-的情感" class="headerlink" title="2018-2019 的情感"></a>2018-2019 的情感</h2><p>这一年的情感生活可以说是五味杂陈。这样的做事显然不符合我一向快刀斩乱麻的风格。不过，天命这种东西，谁知道呢。</p><p>一直都很喜欢钰，可惜去晚了几步。现在嘛，过去的事情就让它过去吧。</p><p>最后的这个月里，真的了解到自己真的用心去喜欢一个人是什么样的从未有过的感觉。为 ta 欢喜，为 ta 忧，仿佛世界没有了 ta，也就没有了中心。</p><p>每天都想见到 ta 甜甜的笑容，想和 ta 去做一些开开心心的事情。</p><p>最重要的一点，我也慢慢开始相信别人。ta 曾经对我说，怕辜负了我的期望。其实这些都是潜移默化之后最终我才发现的，我的唯一的期望或许只是能开开心心的和你长久下去。</p><p>喜欢 ta 的撒娇，喜欢 ta 的可爱，喜欢 ta 甜美的笑容和独特的香味，最喜欢的却是 ta 那天真无暇却又纯洁动人的心灵。</p><h3 id="番外"><a href="#番外" class="headerlink" title="番外"></a>番外</h3><p>一开始那段时间也是不信任的，我就一直在尝试告诉自己无论发生什么事，都是必须以第一信任自己选择的人为前提，所以我一直压在心里。那一段时间真的非常难受。</p><p>现在，这段时间已经度过，或许下一步我该想想怎么和她有更多开心的共同经历了吧。么么哒，钰。</p><h2 id="2019-年的期望"><a href="#2019-年的期望" class="headerlink" title="2019 年的期望"></a>2019 年的期望</h2><ul><li>继续和我深爱的钰甜甜蜜蜜</li><li>上帝保佑，不要挂科</li><li>以战养学，努力学习</li><li>多去几个好玩的地方，多认识其他地方的朋友 </li><li>买个 iPad Pro + Pencil 2 （估计不可能，穷死了）</li><li>练练我的 Djembe，赶快把驾照考完</li><li>还没想到</li></ul><p>好了，就先这样吧。</p><p>2019.1.11 @ AH</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
      <category term="Personal" scheme="https://www.kmahyyg.xyz/tags/Personal/"/>
    
  </entry>
  
  <entry>
    <title>计算机网络期末复习稿</title>
    <link href="https://www.kmahyyg.xyz/2019/ynu-networkbasic/"/>
    <id>https://www.kmahyyg.xyz/2019/ynu-networkbasic/</id>
    <published>2019-01-09T00:06:43.000Z</published>
    <updated>2019-04-13T16:01:32.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="Computer-Network-Chapter-1-Basic-Concepts"><a href="#Computer-Network-Chapter-1-Basic-Concepts" class="headerlink" title="Computer Network - Chapter 1 - Basic Concepts"></a>Computer Network - Chapter 1 - Basic Concepts</h1><p>Host: End System.</p><p>Routers: Forward packets(chunks) of data through network.</p><p>Protocols: Control sending and receiving of messages. A protocol is a set of rules that govern data communication. It is an agreement between the communication entities. The elements of protocol are syntax, semantics, and timing.  </p><ul><li>Syntax: Data structure or format. </li><li>Semantics: the meaning of each section of bits. </li><li>Timing: When to send and how fast it should be.</li></ul><p>C/S: Client/Server Model: Client host requests, receives service from server.</p><p>Peer2Peer model: Minimal (or no) use of dedicated server.</p><h2 id="Level-5-7-Layers-Important"><a href="#Level-5-7-Layers-Important" class="headerlink" title="Level 5/7 Layers (Important)"></a>Level 5/7 Layers (Important)</h2><p>Level 5:</p><p>TCP/IP Layer:</p><table><thead><tr><th style="text-align:center">Application Layer</th><th style="text-align:center">Message</th></tr></thead><tbody><tr><td style="text-align:center">Transport Layer</td><td style="text-align:center">Segment</td></tr><tr><td style="text-align:center">Network Layer</td><td style="text-align:center">Datagram</td></tr><tr><td style="text-align:center">Link Layer</td><td style="text-align:center">Frame</td></tr></tbody></table><p>ISO/OSI Layer:</p><table><thead><tr><th style="text-align:center">Application Layer</th><th style="text-align:center">应用软件接口</th></tr></thead><tbody><tr><td style="text-align:center">Presentation Layer</td><td style="text-align:center">转换格式并封包</td></tr><tr><td style="text-align:center">Session Layer</td><td style="text-align:center">维护会话状态</td></tr><tr><td style="text-align:center">Transport Layer</td><td style="text-align:center">添加传输表头形成片</td></tr><tr><td style="text-align:center">Network Layer</td><td style="text-align:center">形成数据报，决定路径选择与转发</td></tr><tr><td style="text-align:center">Data link Layer</td><td style="text-align:center">网络寻址，错误纠正，形成帧</td></tr><tr><td style="text-align:center">Physical Layer</td><td style="text-align:center">与硬件直接互通</td></tr></tbody></table><h2 id="Store-and-Forward-Important"><a href="#Store-and-Forward-Important" class="headerlink" title="Store and Forward (Important)"></a>Store and Forward (Important)</h2><p>Circuit Switching: A dedicated circuit per call as telephone net.</p><ul><li>End to end resources served for “call”</li><li>Link Bandwidth, Switch Capacity</li><li>Dedicated Resouces</li><li>Circuit-like (guaranteed) performance</li><li>Call setup required</li></ul><p>Example: TDM&amp;FDM, Datagram network <strong>is neither connection-oriented or connection-less</strong></p><p>Packet Switching: Data sent through net in discrete “chunks”</p><p>Pros:</p><ul><li>Divided data stream into packets</li><li>Shared network resources</li><li>each packet uses full link bandwidth</li><li>resources used as needed</li></ul><p>Cons:</p><ul><li>Aggregate resource demand can exceed amount available</li><li>Congestion Control</li><li>Node receives complete packet before forwarding, store and forward</li></ul><h3 id="Delay-Important"><a href="#Delay-Important" class="headerlink" title="Delay (Important)"></a>Delay (Important)</h3><p>Transmission 传输 Delay: From the first sent bit to the last sent bit (Check header and calculate checksum)</p><p>Propagation 传播 Delay: From the first sent bit to the first received bit</p><p>Queuing Delay: From entering queue to send</p><p>Processing Delay: From Send process to queue entrance</p><p>Total delay: the sum of the four delays above.</p><h2 id="Communication"><a href="#Communication" class="headerlink" title="Communication"></a>Communication</h2><p>Full Duplex: Client&amp;Server transfer in 2 directions at the same time.</p><p>Half Deplex: Only Client/Server can transfer at the same time but allow 2 directions.</p><p>Simplex: Only single directions can be used for transmission. (eg. Radio Station)</p><p>Connection Media: </p><p>UnGuided media: </p><ul><li>Wireless network</li><li>Satellite radio</li></ul><p>Guided media:</p><ul><li>Twisted-Pair Wire</li><li>Coaxial cable</li><li>Fiber optics</li></ul><h1 id="Computer-network-Chapter-2-Application-Layer"><a href="#Computer-network-Chapter-2-Application-Layer" class="headerlink" title="Computer network - Chapter 2 - Application Layer"></a>Computer network - Chapter 2 - Application Layer</h1><p>Due to the well-known, this part will be simplified.</p><h2 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h2><p>Process: Progam running within a host, a instance.</p><p>Two processes communicate through IPC. Inter-process communicate by exchanging message.</p><h2 id="Application-Service-you-may-need-to-know"><a href="#Application-Service-you-may-need-to-know" class="headerlink" title="Application Service you may need to know"></a>Application Service you may need to know</h2><h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><p>URL: Protocol + Hostname + Path name</p><p>Pipeline + Connection-alive(Persistent HTTP with single TCP conn) + Stateless</p><p><strong>RTT</strong> : Round-Trip Time. 1 RTT = Send out and get back. Total RTT for HTTP: 2 RTT(1 for initiate conn, one for first request) + Transfer.</p><p>Request Packet Format:</p><pre><code>[METHOD] [PATH NAME] [HTTP Version][\r\n][Headers][\r\n][Data body][\r\n]</code></pre><p>Response Packet Format:</p><pre><code>[HTTP Version] [Status code] [Status Phrase][\r\n][Headers][\r\n][Data: Entity body][\r\n]</code></pre><p>Authentication:<br><img src="https://mdn.mozillademos.org/files/14689/HTTPAuth.png" alt="MDN HTTP 403"></p><p>Conditional GET:<br>Related Header: <code>If-modified-since:</code> <code>304 Not Modified / 200 OK</code></p><h3 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h3><p>Out of band communication: Port 20 for data transfer, Port 21 for command transfer</p><h2 id="Email"><a href="#Email" class="headerlink" title="Email"></a>Email</h2><p>Major Components: User agents + Mail server + DNS + Protocol (SMTP/IMAP/POP3)</p><p>SMTP(25 / 465 SSL / 587 TLS): Push to server. (Send only for now)</p><p>IMAP(143/ 993 Encrypted) &amp; POP3(110/ 995 Encrypted): Pull from client. (Receive at client, IMAP recommended)</p><p>Message in SMTP: 7-bit ASCII Code with Extended S/MIME via Base64 Encode</p><p>SMTP: </p><pre><code>-- Header lines --To:   From:  Subject:   -- Header lines --DATA BODY  [\r\n][\r\n]</code></pre><h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><p>Provide: </p><ul><li>Distributed database based name resolver (Map from domain name to IP address)</li><li>Host aliasing via CNAME</li><li>Mail server aliasing via MX and PTR</li><li>Load distribution</li></ul><p>53/UDP with iterated query, 8 Global Root Server.</p><h2 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h2><p>Socket: The interface (sends to / receives from), middle-man in process and system TCP buffers.<br>Socket Pair: [IP Address:Port]</p><p>Server:</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token keyword">import</span> sys<span class="token keyword">import</span> timeHOST <span class="token operator">=</span> <span class="token string">'0.0.0.0'</span>PORT <span class="token operator">=</span> <span class="token number">23301</span>lsock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># Define protocal stack as IPV4</span>lsock<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Bind IP and port</span>lsock<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">65535</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># max connection number</span>conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> lsock<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Accept Connection</span>data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1492</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># receive data with MTU 1492</span>conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># send data</span>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Client:</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token keyword">import</span> sys<span class="token keyword">import</span> timeHOST <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>PORT <span class="token operator">=</span> <span class="token number">23301</span>recsock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> recsock<span class="token punctuation">.</span>connect_ex<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span>PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># Connect to server</span>recsock<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>b<span class="token string">'HelloWorld!'</span><span class="token punctuation">)</span>data<span class="token operator">=</span>recsock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1492</span><span class="token punctuation">)</span>recsock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Computer-Network-Chapter-3-Transport-layer-Really-matters"><a href="#Computer-Network-Chapter-3-Transport-layer-Really-matters" class="headerlink" title="Computer Network - Chapter 3 - Transport layer (Really matters)"></a>Computer Network - Chapter 3 - Transport layer (Really matters)</h1><p>Transport layer: logical communication between processes</p><p>Network layer: logical communication between hosts</p><h2 id="Multiplex-and-Demultiplex"><a href="#Multiplex-and-Demultiplex" class="headerlink" title="Multiplex and Demultiplex"></a>Multiplex and Demultiplex</h2><p>Demultiplex: delivering received segments to correct socket.</p><p>Multiplex: Gather data from multi sockets and enveloping data with header.</p><p>IP Datagram format: <code>Header fields | 32 Bits SRC IP | 32 Bits DEST IP | DATA</code></p><p>UDP socket: identified by <code>dest IP | dest port</code><br>TCP socket: identified by <code>src IP | src port</code></p><h2 id="Transport-service"><a href="#Transport-service" class="headerlink" title="Transport service"></a>Transport service</h2><p>An app needed:</p><ul><li>Data loss control</li><li>Bandwidth</li><li>Timing(Low delay)</li></ul><h3 id="TCP-Service-Important"><a href="#TCP-Service-Important" class="headerlink" title="TCP Service (Important)"></a>TCP Service (Important)</h3><ul><li>Connection-oriented, full duplex data, pipeline</li><li>Reliable Transport with point to point and in-order</li><li>Flow control</li><li>Congestion control with buffers</li></ul><p>MSS: Max segment size, default 536 Bytes</p><p>Segment Structure:</p><pre><code>| source port | dest port || sequence no | ack no    || head len  | 0 | UAPRSF  ||Receive window | checksum||Urg data pointer| options||        body : data      |</code></pre><h4 id="Reliable-data-transfer"><a href="#Reliable-data-transfer" class="headerlink" title="Reliable data transfer"></a>Reliable data transfer</h4><p>Sequence No. = 第一个字节号</p><p>Piggybacked &amp; Cumulative ACKs: ACK No.: 下一个待传字节号</p><p>TCP 超时重传： Timeout events &amp; Duplicate ACKs</p><p>MSL: Max segment lifetime</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/tcp-handshake-conn.jpg" alt="TCP_CONN"></p><p>SYN_SENT -&gt; SYN_RCVD -&gt; ESTABLISHED -&gt; ESTABLISHED</p><p><img src="https://alicdn.kmahyyg.xyz/asset_files/tcp-handshake-disconn.jpg" alt="TCP_DISCONN"></p><p>FIN_WAIT_1 -&gt; CLOSE_WAIT -&gt; FIN_WAIT_2 -&gt; LAST_ACK -&gt; TIME_WAIT -&gt; CLOSED</p><h4 id="Checksum"><a href="#Checksum" class="headerlink" title="Checksum"></a>Checksum</h4><p>IEEE 802.3 CRC32</p><h3 id="UDP-Service-Important"><a href="#UDP-Service-Important" class="headerlink" title="UDP Service (Important)"></a>UDP Service (Important)</h3><ul><li>Unreliable, unordered delivery (data may be lost)</li><li>Connection-less (no handshake, each segment handled by app): Simple and smaller header</li><li>No congestion control with best-effort</li></ul><p>Used for:</p><ul><li>Loss tolerant, rate sensitive(streaming and multimedia)</li><li>DNS &amp; SNMP</li></ul><p>Packet format:</p><pre><code>        src port        |    dest port    |length including header |    checksum     |</code></pre><p>Checksum:</p><p>Divided data into 16-bit groups and add each one, wrap around if additional bit get.<br>checksum is sum get reversed.</p><h1 id="Computer-network-Chapter-4-Network-Layer"><a href="#Computer-network-Chapter-4-Network-Layer" class="headerlink" title="Computer network - Chapter 4 - Network Layer"></a>Computer network - Chapter 4 - Network Layer</h1><h2 id="Network-Layer-Function"><a href="#Network-Layer-Function" class="headerlink" title="Network Layer Function"></a>Network Layer Function</h2><ul><li>Routing: determine which route should be taken</li><li>Forwarding: process to next hop</li></ul><p>BTW, Virtual circuit networking: router must maintain connection state information, contains path from src to desc, vc no, entries in fwd tables.</p><h2 id="IP-Internet-protocol"><a href="#IP-Internet-protocol" class="headerlink" title="IP: Internet protocol"></a>IP: Internet protocol</h2><h3 id="Data-structure"><a href="#Data-structure" class="headerlink" title="Data structure"></a>Data structure</h3><pre><code>version | head length | type of service |       length      |identifier      |        flags      |   fragment offset     |  TTL     |     Upper Layer         |   IP Checksum         |                            SRC IP                          |                            DEST IP                         |                            Options                         |                            DATA                            |</code></pre><p>Identifier: Used for reassemale segment</p><p>Header len: Min 20 Bytes = 5, Max 60 Bytes = 15;</p><p>Flag: | Reserved 0 | Don’t Fragment (1,DF) | Last Fragment (0,More_F)|</p><p>Type of service: Used for QOS,<br>| Precendence (0-2 bits) | Normal delay (0) | High throughput (1) | High Reliability(1) | Reserved (6-7 Bits) |</p><p>Fragment Offset:</p><p><strong>数据部分切割，不含报头长度</strong> = (PacketLength - HeaderLength) / 8</p><h3 id="Addr"><a href="#Addr" class="headerlink" title="Addr"></a>Addr</h3><p>IPv4 Addr is 32 Bits.</p><p>In binary: </p><p>Class A = 0 + Netid + Hostid<br>Class B = 10 + Netid + Hostid<br>Class C = 110 + Netid + Hostid</p><p>Class D = 1110 + xx (Multicast Addr)<br>Class E = 1111 + yy (Reserved Addr) </p><p>CIDR: 192.168.200.0/24  24:Network mask, previous 24 bits of mask is 1.</p><p>Minimum IP is Subnet Addr, Last IP is multicast IP.</p><p>IP Address AND network mask is CIDR ADDR.</p><h3 id="Hierarchical-Addressing-Route-Aggregation"><a href="#Hierarchical-Addressing-Route-Aggregation" class="headerlink" title="Hierarchical Addressing: Route Aggregation"></a>Hierarchical Addressing: Route Aggregation</h3><p>Autonomous System: An aggregation of routers that they run the same routing algorithm, and one or more of the routers ( is called gateway router) can routing packets to other networks. Use Intra-AS routing protocol for peering with another AS.</p><h2 id="Routing-Algorithms"><a href="#Routing-Algorithms" class="headerlink" title="Routing Algorithms"></a>Routing Algorithms</h2><p>Global: Link state algorithm (Dijkstra)</p><p>Decentralized: Distance vector Algorithm (Bellman-Ford Equation)</p><h3 id="Dijkstra"><a href="#Dijkstra" class="headerlink" title="Dijkstra"></a>Dijkstra</h3><p>TALK IS CHEAP, SHOW ME THE CODE!</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python3</span><span class="token comment" spellcheck="true"># -*- encoding:utf-8 -*-</span><span class="token keyword">import</span> sys<span class="token keyword">class</span> <span class="token class-name">Graph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>vertices<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>V <span class="token operator">=</span> vertices   <span class="token comment" spellcheck="true"># initiate 2D arrays with the number of vertexes</span>        self<span class="token punctuation">.</span>graph <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> column <span class="token keyword">in</span> range<span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> range<span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">printSolution</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>dist<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"  Vertex\tDistance from src"</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># print the solution, loop all vertexes</span>        <span class="token keyword">for</span> node <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>V<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">,</span>node<span class="token punctuation">,</span><span class="token string">"\t\t\t"</span><span class="token punctuation">,</span>dist<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">minDistance</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>dist<span class="token punctuation">,</span>sptSet<span class="token punctuation">)</span><span class="token punctuation">:</span>        min <span class="token operator">=</span> sys<span class="token punctuation">.</span>maxsize  <span class="token comment" spellcheck="true"># assume that all paths have the maximum length</span>        min_index <span class="token operator">=</span> None   <span class="token comment" spellcheck="true"># initial var to avoid non-sense error</span>        <span class="token keyword">for</span> v <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>V<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># find the vertex with minDist from not in sTree</span>            <span class="token keyword">if</span> dist<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">&lt;</span> min <span class="token operator">and</span> sptSet<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>                min <span class="token operator">=</span> dist<span class="token punctuation">[</span>v<span class="token punctuation">]</span>                min_index <span class="token operator">=</span> v        <span class="token keyword">if</span> min_index <span class="token operator">==</span> None<span class="token punctuation">:</span>            <span class="token keyword">raise</span> NotImplementedError        <span class="token keyword">return</span> min_index    <span class="token keyword">def</span> <span class="token function">dijkstra</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>src<span class="token punctuation">)</span><span class="token punctuation">:</span>        dist <span class="token operator">=</span> <span class="token punctuation">[</span>sys<span class="token punctuation">.</span>maxsize<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>V        dist<span class="token punctuation">[</span>src<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment" spellcheck="true"># vertex to itself should be zero</span>        sptSet <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>V  <span class="token comment" spellcheck="true"># Shortest path tree set, initiate</span>        <span class="token comment" spellcheck="true"># choose a vertex</span>        <span class="token keyword">for</span> cout <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>V<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># pick the minDist vertex from not accessed vertexes, first time == src</span>            u <span class="token operator">=</span> self<span class="token punctuation">.</span>minDistance<span class="token punctuation">(</span>dist<span class="token punctuation">,</span>sptSet<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># the minDist vertex put into shortest path tree</span>            sptSet<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>            <span class="token comment" spellcheck="true"># only when current vertex > new vertex, and the vertex not in sptset,</span>            <span class="token comment" spellcheck="true"># update the picked vertex's neighbor's distance (new distance with new node as a relay)</span>            <span class="token keyword">for</span> v <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>V<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>graph<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">and</span> sptSet<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">False</span> <span class="token operator">and</span> dist<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">></span> dist<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>graph<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">:</span>                    dist<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> dist<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>graph<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span>v<span class="token punctuation">]</span>        self<span class="token punctuation">.</span>printSolution<span class="token punctuation">(</span>dist<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    g <span class="token operator">=</span> Graph<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>    g<span class="token punctuation">.</span>graph <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">#A, and no-route should be zero.</span>        <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">#B</span>        <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">#C</span>        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">#D</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">#E</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">#F</span>    <span class="token punctuation">]</span>    g<span class="token punctuation">.</span>dijkstra<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># source is A</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Distance-vector-Algorithm-Bellman-Ford-Equation"><a href="#Distance-vector-Algorithm-Bellman-Ford-Equation" class="headerlink" title="Distance vector Algorithm (Bellman-Ford Equation)"></a>Distance vector Algorithm (Bellman-Ford Equation)</h3><p>D (X to Y) = min {neiborhood V} -&gt; cost(x,v) + cost(v,y)<br>重点：结点获得最短路径的下一跳, 该信息用于转发表中！</p><p>异步迭代:</p><ul><li>引发每次局部迭代的因素</li><li>局部链路费用改变</li><li>来自邻居的DV更新</li></ul><p>分布式:</p><ul><li>每个结点只当DV变化时才通告给邻居</li><li>邻居在必要时（其DV更新后发生改变）再通告它们的邻居</li></ul><h1 id="Computer-Network-Chapter-5-Link-Layer"><a href="#Computer-Network-Chapter-5-Link-Layer" class="headerlink" title="Computer Network - Chapter 5 - Link Layer"></a>Computer Network - Chapter 5 - Link Layer</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Nodes: Hosts and routers</p><p>Links: Communication channels that connect adjacent nodes along communication path.</p><p>Farme: Layer-2 Packet, PDF, encapsulates datagram. </p><p>Responsible for : transfer datagram from one node to adjacent node over a link</p><h2 id="Error-Detection-and-Correlation"><a href="#Error-Detection-and-Correlation" class="headerlink" title="Error Detection and Correlation"></a>Error Detection and Correlation</h2><h3 id="Parity-Bit"><a href="#Parity-Bit" class="headerlink" title="Parity Bit"></a>Parity Bit</h3><p>奇校验 是 奇数个 1 得到的校验位为 0，偶校验 是 偶数个 1 得到的校验位 为 0</p><h3 id="CRC-Cyclic-Redundancy-Check"><a href="#CRC-Cyclic-Redundancy-Check" class="headerlink" title="CRC: Cyclic Redundancy Check"></a>CRC: Cyclic Redundancy Check</h3><p>G:1001=x^3+x^0=x^3+1 D:101110</p><p>G 的最高位恒为 1, D 左移 (len(G)-1) 位后对 G 作 XOR 除法运算，最终得到余数即为 Checksum.</p><p>检验无误： D 左移 (len(G)-1) 位后加上 Checksum 对 G 作 XOR 除法，余数为 0 则正常。</p><h2 id="ARP"><a href="#ARP" class="headerlink" title="ARP"></a>ARP</h2><p>Address Resolution Protocol: IP/MAC address mapping for lan nodes</p><p>ARP Table builder:</p><ul><li>A Broadcast: B’s IP Addr is blahblah，but I don’t know B’s MAC (Dest IP: 192.168.200.255, Dest MAC: FFFFFFFFFFFF)</li><li>B Receive, then replies to A with B’s MAC (unicast)</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="School" scheme="https://www.kmahyyg.xyz/tags/School/"/>
    
  </entry>
  
</feed>
