<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>使用 Backblaze &#43; Cloudflare 搭建 10G 免费网盘 &middot; Pat~ Pat~ Meow~</title>
  <meta name="description" content="迫于云存储空间不足，然后 POOR，本文教你如何搭建免费网盘" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://www.kmahyyg.xyz/css/main.min.css" />
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-123948588-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  <style>
    body {
      background: #ecedef url("https://alicdn.kmahyyg.xyz/asset_files/aether/bgimg.webp") repeat;
    }
  </style>
</head>
  <body class="single-body">
    <nav class="nav-bar side-padding">
  <h1 class="nav-header"><a href="https://www.kmahyyg.xyz/" class="nav-text">Patrick Young</a></h1>
  <div class="hamburger-menu">
    <button onclick="hamburgerMenuPressed.call(this)" aria-haspopup="true" aria-expanded="false" aria-controls="menu" aria-label="Menu">
      <span></span>
      <span></span>
    </button>
    <ul id="menu" class="hamburger-menu-overlay">
      <li><a href="https://www.kmahyyg.xyz/" class="hamburger-menu-overlay-link">Home</a></li>
      <li><a href="https://www.kmahyyg.xyz/express-page/" class="hamburger-menu-overlay-link">Express Inc</a></li>
      <li><a href="https://www.kmahyyg.xyz/about-me-page/" class="hamburger-menu-overlay-link">About</a></li>
      <li><a href="https://www.kmahyyg.xyz/archlinux-bug-page/" class="hamburger-menu-overlay-link">Arch Linux</a></li>
      <li><a href="https://www.kmahyyg.xyz/donate-page/" class="hamburger-menu-overlay-link">Donate</a></li>
      <li><a href="https://www.kmahyyg.xyz/categories/code" class="hamburger-menu-overlay-link">Code</a></li><li><a href="https://www.kmahyyg.xyz/categories/life" class="hamburger-menu-overlay-link">Life</a></li><li><a href="https://www.kmahyyg.xyz/categories/network" class="hamburger-menu-overlay-link">Network</a></li><li><a href="https://www.kmahyyg.xyz/categories/school" class="hamburger-menu-overlay-link">School</a></li><li><a href="https://www.kmahyyg.xyz/categories/tech" class="hamburger-menu-overlay-link">Tech</a></li>
    </ul>
  </div>
</nav>
    <main class="content side-text-padding">
      <article class="post ">
        <header class="post-header">
        	<h1 class="post-title">使用 Backblaze &#43; Cloudflare 搭建 10G 免费网盘</h1>
          <p class="post-date">Posted <time datetime="2018-11-11">Nov 11, 2018</time></p>
        </header>
        
        <picture class="post-figure">
            
            <source srcset="https://alicdn.kmahyyg.xyz/asset_files/aether/cat_code.webp">
          <img src="https://alicdn.kmahyyg.xyz/asset_files/aether/cat_code.webp" >
        </picture>
        
        

<h1 id="preface">Preface</h1>

<p>Backblaze 作为一家专业提供云存储服务的厂商为我们提供了一个 B2 Cloud Storage 服务。其免费额度包含 10GiB 存储空间 + 每天 1 GiB 下载流量 + 每天 2500 次的 API 调用量。近期，由于 Cloudflare CDN 到 B2 服务器的流量不再计费，我们可以利用这一特性打造不限下载流量，附带全球免费 CDN 加成的下载网盘。</p>

<h1 id="deploy">Deploy</h1>

<h2 id="注册和登陆">注册和登陆</h2>

<p>按照文字提示处理，B2 注册的时候不需要提供信用卡，请提供真实的账单地址以供验证。请注册完成之后创建 Bucket，然后任意上传一个文件，记录下该文件的 Friendly Download Address，以备后续使用。</p>

<h2 id="接入-cloudflare">接入 Cloudflare</h2>

<p>请参考我之前的博文： <a href="/2018/CAMAL-OfflineDL/">CAMAL 离线下载套件</a></p>

<p>接入时的几点注意：</p>

<ul>
<li>如果您使用 CNAME 方式接入，请注意检查是否已经由 Cloudflare 正确下发证书。</li>
<li>B2 Cloud Storage 要求请求的 URL 必须为 HTTPS，请您注意您分发时的 URL.</li>
<li>使用 CNAME 方式接入时的回源地址应为你的 Friendly Download Address 中的域名，如果这个方式无法正确下发域名，请您将其临时更改为其他启用了 HTTPS 的大站的域名并重新禁用、启用一次 Cloudflare Universal SSL，等待下发证书成功后改回即可。</li>
<li>接入完成并确认证书正确下发后再根据 Reference 设置您的 Page Rules 用以屏蔽未授权的访问。</li>
<li>在您的 权威 DNS 端的 CNAME 设置也请参考我之前的博文，如果存在问题，请先改为由伙伴面板提供的 CNAME 再切换为您想定义的其他线路。</li>
</ul>

<p>最终的文件访问 URL 格式应当为：  <code>https://&lt;YOUR CUSTOM DOMAIN WITH CLOUDFLARE ACCLERATED&gt;/file/&lt;BUCKET NAME&gt;/&lt;FILE NAME&gt;</code></p>

<p>具体的 B2 云存储相关的安全设置请参考 Backblaze 官方文档，Cloudflare 安全性相关设置请参考 Cloudflare 官方文档并结合您的自身需求。</p>

<p>Recommended Page Rules:</p>

<p><img src="https://alicdn.kmahyyg.xyz/asset_files/2018-b2cf-01.webp" alt="Recommended Page Rules" /></p>

<h1 id="reference">Reference</h1>

<ul>
<li><a href="https://help.backblaze.com/hc/en-us/articles/217666928-Using-Backblaze-B2-with-the-Cloudflare-CDN">https://help.backblaze.com/hc/en-us/articles/217666928-Using-Backblaze-B2-with-the-Cloudflare-CDN</a></li>
<li><a href="https://www.kmahyyg.xyz/2018/CAMAL-OfflineDL/">https://www.kmahyyg.xyz/2018/CAMAL-OfflineDL/</a></li>
</ul>

      </article>
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kmahyyg" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </main>
    <nav class="end-nav side-padding">
      
      <a ontouchstart="cardPressed.call(this)" ontouchend="cardReleased.call(this)" ontouchmove="cardReleased.call(this)" 
  href="https://www.kmahyyg.xyz/" class="card home-card" style="background-image: url( https://alicdn.kmahyyg.xyz/asset_files/aether/backtohome.webp )" rel="bookmark" >
  Home
</a>
    </nav>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
<script src="https://www.kmahyyg.xyz/js/core.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
  </body>
</html>